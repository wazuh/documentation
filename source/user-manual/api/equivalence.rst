.. Copyright (C) 2021 Wazuh, Inc.


.. Migrating from the Wazuh API 3.X

Migrating from the Wazuh API 3.X
================================

Wazuh API v4 introduces several new endpoints and also modifies or removes some of the old ones. The biggest change for all existing endpoints is the new response format. Endpoint responses have been changed according to the new RBAC standard and will no longer have ``items`` and ``totalitems`` fields. Most responses will have the following structure instead:

.. code-block:: json
    :class: output

    {
       "data": {
          "affected_items": [],
          "total_affected_items": 0,
          "total_failed_items": 0,
          "failed_items": [],
       },
       "message": "",
       "error": 0
    }


Migrating users
-----------------

The Wazuh API users are not migrated when upgrading the Wazuh API from 3.X to 4.3. It is not recommended to migrate the users since there are numerous security changes to the Wazuh API.
However, using the following API calls it is easy to create new users and assign the administrator role to it (substitute <username> and <password>):

**Create new user** (:api-ref:`POST /security/users <operation/api.controllers.security_controller.create_user>`)

.. code-block:: console

    # curl -k -X POST "https://localhost:55000/security/users" -H  "Authorization: Bearer $TOKEN"  -H  "Content-Type: application/json" -d "{\"username\":\"<username>\",\"password\":\"<password>\"}"

.. code-block:: json
    :class: output

    {
      "data": {
        "affected_items": [
          {
            "id": 3,
            "username": "<wazuh>",
            "allow_run_as": false,
            "roles": []
          }
        ],
        "total_affected_items": 1,
        "total_failed_items": 0,
        "failed_items": []
      },
      "message": "User was successfully created",
      "error": 0
    }

**Assign administrator role** (:api-ref:`POST /security/users/{user_id}/roles <operation/api.controllers.security_controller.set_user_role>`)

.. code-block:: console

    # curl -k -X POST "https://localhost:55000/security/users/3/roles?role_ids=1" -H  "Authorization: Bearer $TOKEN"

.. code-block:: json
    :class: output

    {
      "data": {
        "affected_items": [
          {
            "id": 3,
            "username": "<wazuh>",
            "allow_run_as": false,
            "roles": [
              1
            ]
          }
        ],
        "total_affected_items": 1,
        "total_failed_items": 0,
        "failed_items": []
      },
      "message": "All roles were linked to user <wazuh>",
      "error": 0
    }

Equivalence table
-----------------

Wazuh API v4 introduced several changes to existing endpoints. It is therefore important to review those changes when migrating to ``4.3``.

The following tables contain the equivalencies between old API 3.x and API 4.3 endpoints:

:api-ref:`Active Response <tag/Active-response>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+--------------------------------+-------------------------------------+----------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Action                         | API 3.x                             | API 4.3                                                                                            | Changes                                                                                        |
+================================+=====================================+====================================================================================================+================================================================================================+
|                                |                                     |                                                                                                    | The new Active Response endpoint runs commands in all agents by default.                       |
|                                |                                     |                                                                                                    |                                                                                                |
| Run an AR command in the agent | ``PUT /active-response/{agent_id}`` | :api-ref:`PUT /active-response <operation/api.controllers.active_response_controller.run_command>` | Use the ``agents_list`` parameter to apply the commands to only one agent or a list of agents. |
|                                |                                     |                                                                                                    |                                                                                                |
|                                |                                     |                                                                                                    | Use the ``alert`` parameter in the JSON body to include alert related information.             |
+--------------------------------+-------------------------------------+----------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+

:api-ref:`Agents <tag/Agents>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                                           | API 3.x usage                                                 | API 4.3 usage                                                                                                                       | Changes                                                                                                                                                                                        |
+==================================================+===============================================================+=====================================================================================================================================+================================================================================================================================================================================================+
|                                                  |                                                               |                                                                                                                                     | Removed ``ids`` query parameter.                                                                                                                                                               |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Use the ``agents_list`` parameter instead of ``ids`` to indicate which agents must be deleted.                                                                                                 |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Now the ``status`` parameter is mandatory. Its value must be one of the following: ``all``, ``active``, ``pending``, ``disconnected``, ``never_connected``.                                    |
| Delete agents                                    | ``DELETE /agents``                                            | :api-ref:`DELETE /agents <operation/api.controllers.agent_controller.delete_agents>`                                                |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | If no ``agents_list`` or ``status`` are provided no agents will be removed. In order to remove all agents, they must be specified with the ``all`` keyword.                                    |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Added same filters that exist in :api-ref:`GET /agents <operation/api.controllers.agent_controller.get_agents>`. Use new filters to delete agents based on any criteria.                       |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Removed ``older_than`` field from response. Now the values of the filters are specified in the error message when there is any failed item.                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Delete an agent                                  | ``DELETE /agents/{agent_id}``                                 | :api-ref:`DELETE /agents?agents_list=agent_id <operation/api.controllers.agent_controller.delete_agents>`                           | Use the ``agents_list`` parameter to indicate which agents must be deleted.                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Added ``groups_list`` parameter in query to specify an array of group's ID to remove from the agent.                                                                                           |
| Remove all agents groups                         | ``DELETE /agents/{agent_id}/group``                           | :api-ref:`DELETE /agents/{agent_id}/group <operation/api.controllers.agent_controller.delete_single_agent_multiple_groups>`         |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Removes the agent from all groups by default or a list of them if ``groups_list`` parameter is found.                                                                                          |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Remove a single group of an agent                | ``DELETE /agents/{agent_id}/group/{group_id}``                | :api-ref:`DELETE /agents/{agent_id}/group/{group_id} <operation/api.controllers.agent_controller.delete_single_agent_single_group>` | No changes.                                                                                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Remove a single group of multiple agents         | ``DELETE /agents/group/{group_id}``                           | :api-ref:`DELETE /agents/group?group_id=id <operation/api.controllers.agent_controller.delete_multiple_agent_single_group>`         | Use the ``agents_list`` parameter to indicate which agents the group should be removed from.                                                                                                   |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | The new endpoint can delete all groups or a list of them.                                                                                                                                      |
| Delete a list of groups                          | ``DELETE /agents/groups``                                     | :api-ref:`DELETE /groups <operation/api.controllers.agent_controller.delete_agents>`                                                |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Use the ``groups_list`` to choose groups to delete. If no ``groups_list`` is provided no groups will be removed. In order to remove all groups, it must be specified with the ``all`` keyword. |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | The new endpoint can delete all groups or a list of them.                                                                                                                                      |
| Remove a group                                   | ``DELETE /agents/groups/{group_id}``                          | :api-ref:`DELETE /groups?groups_list=group_id <operation/api.controllers.agent_controller.delete_groups>`                           |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Use the ``groups_list`` to choose groups to delete. If no ``groups_list`` is provided no agents will be removed. In order to remove all groups, it must be specified with the ``all`` keyword. |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Return information about all available agents or a list of them.                                                                                                                               |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Added parameter ``agents_list`` in query used to specify a list of agent IDs (separated by comma) to get the information from.                                                                 |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
| Get all agents                                   | ``GET /agents``                                               | :api-ref:`GET /agents <operation/api.controllers.agent_controller.get_agents>`                                                      | Added parameter ``registerIP`` in query used to filter by the IP used when registering the agent.                                                                                              |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | With this new endpoint, you won't get a 400 response in agent name cannot be found,                                                                                                            |
|                                                  |                                                               |                                                                                                                                     | you will get a 200 response with 0 items in the result.                                                                                                                                        |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Now, the values of ``status`` in the response no longer start with capital letter.                                                                                                             |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get an agent                                     | ``GET /agents/{agent_id}``                                    | :api-ref:`GET /agents?agents_list=agent_id <operation/api.controllers.agent_controller.get_agents>`                                 | Use the ``agents_list`` parameter to indicate which agents to get the information from.                                                                                                        |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get active configuration                         | ``GET /agents/{agent_id}/config/{component}/{configuration}`` | :api-ref:`GET /agents/{agent_id}/config/{component}/{configuration} <operation/api.controllers.agent_controller.get_agent_config>`  | No changes.                                                                                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get sync status of agent                         | ``GET /agents/{agent_id}/group/is_sync``                      | :api-ref:`GET /agents/{agent_id}/group/is_sync <operation/api.controllers.agent_controller.get_sync_agent>`                         | No changes.                                                                                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get agent key                                    | ``GET /agents/{agent_id}/key``                                | :api-ref:`GET /agents/{agent_id}/key <operation/api.controllers.agent_controller.get_agent_key>`                                    | No changes.                                                                                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Use the ``agents_list`` parameter to indicate which agents will be consulted.                                                                                                                  |
| Get upgrade result from agent                    | ``GET /agents/{agent_id}/upgrade_result``                     | :api-ref:`GET /agents/upgrade_result?agents_list=agent_ids <operation/api.controllers.agent_controller.get_agent_upgrade>`          |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Added new filters ``os.platform``, ``os.version``, ``os.name``, ``manager``, ``version``, ``group``, ``node_name``, ``name``, ``ip``, ``registerIP`` and the ``q`` parameter.                  |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | The new endpoint works the same way by default.                                                                                                                                                |
| Get groups                                       | ``GET /agents/groups``                                        | :api-ref:`GET /groups <operation/api.controllers.agent_controller.get_list_group>`                                                  |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Removed ``q`` parameter in query.                                                                                                                                                              |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Use the ``groups_list`` parameter to indicate which groups to get the information from.                                                                                                        |
| Get agents in a group                            | ``GET /agents/groups/{group_id}``                             | :api-ref:`GET /groups?groups_list=group_id <operation/api.controllers.agent_controller.get_list_group>`                             |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | To get all agents in a group use :api-ref:`GET /groups/{group_id}/agents <operation/api.controllers.agent_controller.get_agents_in_group>`.                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get group configuration                          | ``GET /agents/groups/{group_id}/configuration``               | :api-ref:`GET /groups/{group_id}/configuration <operation/api.controllers.agent_controller.get_group_config>`                       | The new endpoint works the same way by default.                                                                                                                                                |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get group files                                  | ``GET /agents/groups/{group_id}/files``                       | :api-ref:`GET /groups/{group_id}/files <operation/api.controllers.agent_controller.get_group_files>`                                | The new endpoint works the same way by default.                                                                                                                                                |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get a file in group                              | ``GET /agents/groups/{group_id}/files/{filename}``            | :api-ref:`GET /groups/{group_id}/files/{file_name}/json <operation/api.controllers.agent_controller.get_group_file_json>` or        | The new endpoint allows the user to get the specified group file parsed to JSON or XML.                                                                                                        |
|                                                  |                                                               | :api-ref:`GET /groups/{group_id}/files/{file_name}/xml <operation/api.controllers.agent_controller.get_group_file_xml>`             |                                                                                                                                                                                                |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get an agent by its name                         | ``GET /agents/name/{agent_name}``                             | :api-ref:`GET /agents?name=agent_name <operation/api.controllers.agent_controller.get_agents>`                                      | Use the ``name`` parameter to indicate which agent to get the information from.                                                                                                                |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get agents without group                         | ``GET /agents/no_group``                                      | :api-ref:`GET /agents/no_group <operation/api.controllers.agent_controller.get_agent_no_group>`                                     | Now, the values of ``status`` in the response no longer start with capital letter.                                                                                                             |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get outdated agents                              | ``GET /agents/outdated``                                      | :api-ref:`GET /agents/outdated <operation/api.controllers.agent_controller.get_agent_outdated>`                                     | Added ``search`` parameter in query used to look for elements with the specified string.                                                                                                       |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get distinct fields in agents                    | ``GET /agents/stats/distinct``                                | :api-ref:`GET /agents/stats/distinct <operation/api.controllers.agent_controller.get_agent_fields>`                                 | Now, the values of ``status`` in the response no longer start with capital letter.                                                                                                             |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get agents summary                               | ``GET /agents/summary``                                       | :api-ref:`GET /agents/summary/status <operation/api.controllers.agent_controller.get_agent_summary_status>`                         | The statuses in the response no longer start with capital letter.                                                                                                                              |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Removed ``offset`` parameter in query.                                                                                                                                                         |
|                                                  |                                                               |                                                                                                                                     | Removed ``limit`` parameter in query.                                                                                                                                                          |
| Get OS summary                                   | ``GET /agents/summary/os``                                    | :api-ref:`GET /agents/summary/os <operation/api.controllers.agent_controller.get_agent_summary_os>`                                 | Removed ``sort`` parameter in query.                                                                                                                                                           |
|                                                  |                                                               |                                                                                                                                     | Removed ``search`` parameter in query.                                                                                                                                                         |
|                                                  |                                                               |                                                                                                                                     | Removed ``q`` parameter in query.                                                                                                                                                              |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Add agent                                        | ``POST /agents``                                              | :api-ref:`POST /agents <operation/api.controllers.agent_controller.add_agent>`                                                      | Renamed ``force`` parameter in request body to ``force_time``.                                                                                                                                 |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Add a list of agents to a group                  | ``POST /agents/group/{group_id}``                             | :api-ref:`PUT /agents/group <operation/api.controllers.agent_controller.put_multiple_agent_single_group>`                           | Use PUT instead of POST and specify the group id using the ``group_id`` parameter.                                                                                                             |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Put configuration file (agent.conf) into a group | ``POST /agents/groups/{group_id}/configuration``              | :api-ref:`PUT /groups/{group_id}/configuration <operation/api.controllers.agent_controller.put_group_config>`                       | The new endpoint works the same way but using PUT.                                                                                                                                             |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Upload file into a group                         | ``POST /agents/groups/{group_id}/files/{file_name}``          | :api-ref:`PUT /groups/{group_id}/configuration <operation/api.controllers.agent_controller.put_group_config>`                       | The new endpoint is used to update the group configuration. Use PUT instead of POST.                                                                                                           |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Insert agent                                     | ``POST /agents/insert``                                       | :api-ref:`POST /agents/insert <operation/api.controllers.agent_controller.insert_agent>`                                            | Renamed ``force`` parameter in request body to ``force_time``.                                                                                                                                 |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Restart a list of agents                         | ``POST /agents/restart``                                      | :api-ref:`PUT /agents/restart <operation/api.controllers.agent_controller.restart_agents>`                                          | Works the same way but using PUT instead of POST.                                                                                                                                              |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Add agent group                                  | ``PUT /agents/{agent_id}/group/{group_id}``                   | :api-ref:`PUT /agents/{agent_id}/group/{group_id}  <operation/api.controllers.agent_controller.put_agent_single_group>`             | No changes.                                                                                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Restart an agent                                 | ``PUT /agents/{agent_id}/restart``                            | :api-ref:`PUT /agents/{agent_id}/restart  <operation/api.controllers.agent_controller.restart_agent>`                               | No changes.                                                                                                                                                                                    |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Changed parameter type ``force`` in request body from integer to boolean.                                                                                                                      |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Use the ``agents_list`` parameter to indicate which agents should be upgraded. In order to upgrade all agents, they must be specified with the ``all`` keyword.                                |
| Upgrade agent using online repository            | ``PUT /agents/{agent_id}/upgrade``                            | :api-ref:`PUT /agents/upgrade?agents_list=agent_ids  <operation/api.controllers.agent_controller.put_upgrade_agent>`                |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Changed parameter used to set the version to upgrade agents to from ``version`` to ``upgrade_version``.                                                                                        |
|                                                  |                                                               |                                                                                                                                     |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Added new filters ``os.platform``, ``os.version``, ``os.name``, ``manager``, ``version``, ``group``, ``node_name``, ``name``, ``ip``, ``registerIP`` and the ``q`` parameter.                  |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Use the ``agents_list`` parameter to indicate which agents should be upgraded. In order to upgrade all agents, they must be specified with the ``all`` keyword.                                |
| Upgrade agent using custom file                  | ``PUT /agents/{agent_id}/upgrade_custom``                     | :api-ref:`PUT /agents/upgrade_custom?agents_list=agent_ids  <operation/api.controllers.agent_controller.put_upgrade_custom_agent>`  |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Added new filters ``os.platform``, ``os.version``, ``os.name``, ``manager``, ``version``, ``group``, ``node_name``, ``name``, ``ip``, ``registerIP`` and the ``q`` parameter.                  |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Add agent (quick method)                         | ``PUT /agents/{agent_name}``                                  | :api-ref:`POST /agents/insert/quick?agent_name=name  <operation/api.controllers.agent_controller.post_new_agent>`                   | Use POST instead of PUT and the ``agent_name`` parameter to specify the name of the new agent.                                                                                                 |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Create a group                                   | ``PUT /agents/groups/{group_id}``                             | :api-ref:`POST /groups  <operation/api.controllers.agent_controller.post_group>`                                                    | Use POST instead of PUT and the ``group_id`` parameter in request body to specify the name of the new group.                                                                                   |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Restart agents which belong to a group           | ``PUT /agents/groups/{group_id}/restart``                     | :api-ref:`PUT /agents/group/{group_id}/restart  <operation/api.controllers.agent_controller.restart_agents_by_group>`               | The new endpoint works the same way by default.                                                                                                                                                |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                  |                                                               |                                                                                                                                     | Added ``agents_list`` parameter in query to specify which agents must be restarted.                                                                                                            |
| Restart all agents                               | ``PUT /agents/restart``                                       | :api-ref:`PUT /agents/restart  <operation/api.controllers.agent_controller.restart_agents>`                                         |                                                                                                                                                                                                |
|                                                  |                                                               |                                                                                                                                     | Restarts all agents by default or a list of them if ``agents_list`` parameter is used.                                                                                                         |
+--------------------------------------------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Cache
~~~~~

+----------------------------+---------------------------+-------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
| Action                     | API 3.x                   | API 4.3                                                                                         | Changes                                                                                     |
+============================+===========================+=================================================================================================+=============================================================================================+
| Delete cache index         | ``DELETE /cache``         | None                                                                                            | Not needed anymore. Cache is managed by the cluster.                                        |
+----------------------------+---------------------------+-------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
| Clear group cache          | ``DELETE /cache/{group}`` | None                                                                                            | Not needed anymore. Cache is managed by the cluster.                                        |
+----------------------------+---------------------------+-------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
| Get cache index            | ``GET /cache``            | None                                                                                            | Not needed anymore. Cache is managed by the cluster.                                        |
+----------------------------+---------------------------+-------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
| Return cache configuration | ``GET /cache/config``     | :api-ref:`GET /cluster/api/config <operation/api.controllers.cluster_controller.get_api_config>`| The current cache configuration for any API can now be retrieved with the cluster endpoint. |
+----------------------------+---------------------------+-------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+

:api-ref:`Ciscat <tag/Ciscat>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-----------------------------------+------------------------------------+-------------------------------------------------------------------------------------------------------------------+-----------------------------------+
| Action                            | API 3.x usage                      | API 4.3 usage                                                                                                     | Changes                           |
+===================================+====================================+===================================================================================================================+===================================+
| Get CIS-CAT results from an agent | ``GET /ciscat/{agent_id}/results`` | :api-ref:`GET /ciscat/{agent_id}/results <operation/api.controllers.ciscat_controller.get_agents_ciscat_results>` | No changes.                       |
+-----------------------------------+------------------------------------+-------------------------------------------------------------------------------------------------------------------+-----------------------------------+

:api-ref:`Cluster <tag/Cluster>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                                                    | API 3.x usage                                                 | API 4.3 usage                                                                                                                              | Changes                                                                                                                                                                                                               |
+===========================================================+===============================================================+============================================================================================================================================+=======================================================================================================================================================================================================================+
|                                                           |                                                               | :api-ref:`DELETE /decoders/files/{filename} <operation/api.controllers.decoder_controller.delete_file>`                                    |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
| Delete a remote file in a cluster node                    | ``DELETE /cluster/{node_id}/files``                           | :api-ref:`DELETE /lists/files/{filename} <operation/api.controllers.cdb_list_controller.delete_file>`                                      | Divided into more specific endpoints.                                                                                                                                                                                 |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
|                                                           |                                                               | :api-ref:`DELETE /rules/files/{filename} <operation/api.controllers.rule_controller.delete_file>`                                          |                                                                                                                                                                                                                       |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get active configuration in node node_id                  | ``GET /cluster/{node_id}/config/{component}/{configuration}`` | :api-ref:`GET /cluster/{node_id}/configuration/{component}/{configuration} <operation/api.controllers.cluster_controller.get_node_config>` | No changes.                                                                                                                                                                                                           |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node node_id’s configuration                          | ``GET /cluster/{node_id}/configuration``                      | :api-ref:`GET /cluster/{node_id}/configuration <operation/api.controllers.cluster_controller.get_configuration_node>`                      | Added parameter ``raw`` to return configuration in XML format.                                                                                                                                                        |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Check Wazuh configuration in a cluster node               | ``GET /cluster/{node_id}/configuration/validation``           | :api-ref:`GET /cluster/configuration/validation?nodes_list=node_id <operation/api.controllers.cluster_controller.get_conf_validation>`     | Use this endpoint to check if Wazuh configuration is correct for al cluster nodes or use ``nodes_list`` parameter to check only for a list of nodes.                                                                  |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               | :api-ref:`GET /decoders/files/{filename} <operation/api.controllers.decoder_controller.get_file>`                                          |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
| Get local file from any cluster node                      | ``GET /cluster/{node_id}/files``                              | :api-ref:`GET /lists/files/{filename} <operation/api.controllers.cdb_list_controller.get_file>`                                            | Divided into more specific endpoints.                                                                                                                                                                                 |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
|                                                           |                                                               | :api-ref:`GET /rules/files/{filename} <operation/api.controllers.rule_controller.get_file>`                                                |                                                                                                                                                                                                                       |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node_id’s information                                 | ``GET /cluster/{node_id}/info``                               | :api-ref:`GET /cluster/{node_id}/info <operation/api.controllers.cluster_controller.get_info_node>`                                        | No changes.                                                                                                                                                                                                           |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get ossec.log from a specific node in cluster.            | ``GET /cluster/{node_id}/logs``                               | :api-ref:`GET /cluster/{node_id}/logs <operation/api.controllers.cluster_controller.get_log_node>`                                         | Renamed ``category`` parameter in query to ``tag``.                                                                                                                                                                   |
|                                                           |                                                               |                                                                                                                                            | Renamed ``type_log`` parameter in query to ``level``.                                                                                                                                                                 |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get summary of ossec.log from a specific node in cluster. | ``GET /cluster/{node_id}/logs/summary``                       | :api-ref:`GET /cluster/{node_id}/logs/summary <operation/api.controllers.cluster_controller.get_log_summary_node>`                         | No changes.                                                                                                                                                                                                           |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               |                                                                                                                                            | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                                                            |
| Get node node_id’s stats                                  | ``GET /cluster/{node_id}/stats``                              | :api-ref:`GET /cluster/{node_id}/stats <operation/api.controllers.cluster_controller.get_stats_node>`                                      |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            | Changed date format from YYYYMMDD to YYYY-MM-DD for ``date`` parameter in query.                                                                                                                                      |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node node_id’s analysisd stats                        | ``GET /cluster/{node_id}/stats/analysisd``                    | :api-ref:`GET /cluster/{node_id}/stats/analysisd <operation/api.controllers.cluster_controller.get_stats_analysisd_node>`                  | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                                                            |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node node_id’s stats per hour                         | ``GET /cluster/{node_id}/stats/hourly``                       | :api-ref:`GET /cluster/{node_id}/stats/hourly <operation/api.controllers.cluster_controller.get_stats_hourly_node>`                        | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                                                            |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node node_id’s remoted stats                          | ``GET /cluster/{node_id}/stats/remoted``                      | :api-ref:`GET /cluster/{node_id}/stats/remoted <operation/api.controllers.cluster_controller.get_stats_remoted_node>`                      | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                                                            |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               |                                                                                                                                            | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                                                            |
| Get node node_id’s stats per week                         | ``GET /cluster/{node_id}/stats/weekly``                       | :api-ref:`GET /cluster/{node_id}/stats/weekly <operation/api.controllers.cluster_controller.get_stats_weekly_node>`                        |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            | Parameter ``hours`` changed to ``averages`` in response body.                                                                                                                                                         |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node node_id’s status                                 | ``GET /cluster/{node_id}/status``                             | :api-ref:`GET /cluster/{node_id}/status <operation/api.controllers.cluster_controller.get_status_node>`                                    | No changes.                                                                                                                                                                                                           |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get the cluster configuration                             | ``GET /cluster/config``                                       | :api-ref:`GET /cluster/local/config <operation/api.controllers.cluster_controller.get_config>`                                             | Use the ``cluster/local/config`` endpoint instead. This will get the current configuration of the node receiving the request.                                                                                         |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               |                                                                                                                                            | Added ``nodes_list`` parameter in query.                                                                                                                                                                              |
| Check Wazuh configuration in all cluster nodes            | ``GET /cluster/configuration/validation``                     | :api-ref:`GET /cluster/configuration/validation <operation/api.controllers.cluster_controller.get_conf_validation>`                        |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            | Return whether the Wazuh configuration is correct or not in all cluster nodes                                                                                                                                         |
|                                                           |                                                               |                                                                                                                                            | or a list of them if parameter ``nodes_list`` is used.                                                                                                                                                                |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Show cluster health                                       | ``GET /cluster/healthcheck``                                  | :api-ref:`GET /cluster/healthcheck <operation/api.controllers.cluster_controller.get_healthcheck>`                                         | Renamed ``node`` parameter in query to ``nodes_list``.                                                                                                                                                                |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get local node info                                       | ``GET /cluster/node``                                         | :api-ref:`GET /cluster/nodes?agents_list=agent_id <operation/api.controllers.cluster_controller.get_cluster_nodes>`                        | Use the ``agents_list`` parameter to indicate which agents to get the information from.                                                                                                                               |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               |                                                                                                                                            | Get information about all nodes in the cluster or a list of them                                                                                                                                                      |
| Get nodes info                                            | ``GET /cluster/nodes``                                        | :api-ref:`GET /cluster/nodes <operation/api.controllers.cluster_controller.get_cluster_nodes>`                                             |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            | Added ``nodes_list`` parameter in query used to specify which nodes to get the information from.                                                                                                                      |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get node info                                             | ``GET /cluster/nodes/{node_name}``                            | :api-ref:`GET /cluster/nodes?nodes_list=node_id <operation/api.controllers.cluster_controller.get_cluster_nodes>`                          | Use the ``nodes_list`` parameter to indicate which nodes to get the information from.                                                                                                                                 |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get info about cluster status                             | ``GET /cluster/status``                                       | :api-ref:`GET /cluster/status <operation/api.controllers.cluster_controller.get_status>`                                                   | No changes.                                                                                                                                                                                                           |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               | :api-ref:`PUT /decoders/files/{filename} <operation/api.controllers.decoder_controller.put_file>`                                          |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
| Update local file from any cluster node                   | ``PUT /cluster/{node_id}/files``                              | :api-ref:`PUT /lists/files/{filename} <operation/api.controllers.cdb_list_controller.put_file>`                                            | Divided into more specific endpoints.                                                                                                                                                                                 |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
|                                                           |                                                               | :api-ref:`PUT /rules/files/{filename} <operation/api.controllers.rule_controller.put_file>`                                                |                                                                                                                                                                                                                       |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               | :api-ref:`PUT /decoders/files/{filename} <operation/api.controllers.decoder_controller.put_file>`                                          |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
| Upload local file to any cluster node                     | ``POST /cluster/{node_id}/files``                             | :api-ref:`PUT /lists/files/{filename} <operation/api.controllers.cdb_list_controller.put_file>`                                            | Use ``PUT`` instead of ``POST``.                                                                                                                                                                                      |
|                                                           |                                                               |                                                                                                                                            |                                                                                                                                                                                                                       |
|                                                           |                                                               | :api-ref:`PUT /rules/files/{filename} <operation/api.controllers.rule_controller.put_file>`                                                |                                                                                                                                                                                                                       |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Restart a specific node in cluster                        | ``PUT /cluster/{node_id}/restart``                            | :api-ref:`PUT /cluster/restart?nodes_list=node_id <operation/api.controllers.cluster_controller.put_restart>`                              | Use the ``nodes_list`` parameter to indicate the nodes to restart.                                                                                                                                                    |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           |                                                               |                                                                                                                                            | Added ``nodes_list`` parameter in query                                                                                                                                                                               |
| Restart all nodes in cluster                              | ``PUT /cluster/restart``                                      | :api-ref:`PUT /cluster/restart <operation/api.controllers.cluster_controller.put_restart>`                                                 |                                                                                                                                                                                                                       |
|                                                           |                                                               |                                                                                                                                            | Restarts all nodes in the cluster by default or a list of them if ``nodes_list`` is found.                                                                                                                            |
+-----------------------------------------------------------+---------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

:api-ref:`Decoders <tag/Decoders>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------------------+-----------------------------------+---------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                  | API 3.x usage                     | API 4.3 usage                                                                                           | Changes                                                                                                                                                          |
+=========================+===================================+=========================================================================================================+==================================================================================================================================================================+
|                         |                                   |                                                                                                         | Added ``decoder_names`` parameter in query used to specify a list of decoder's names to get.                                                                     |
|                         |                                   |                                                                                                         |                                                                                                                                                                  |
|                         |                                   |                                                                                                         | Added ``select`` parameter in query.                                                                                                                             |
|                         |                                   |                                                                                                         |                                                                                                                                                                  |
| Get all decoders        | ``GET /decoders``                 | :api-ref:`GET /decoders <operation/api.controllers.decoder_controller.get_decoders>`                    | Renamed ``file`` parameter in query to ``filename``.                                                                                                             |
|                         |                                   |                                                                                                         |                                                                                                                                                                  |
|                         |                                   |                                                                                                         | Renamed ``path`` parameter in query to ``relative_dirname``.                                                                                                     |
+-------------------------+-----------------------------------+---------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get decoders by name    | ``GET /decoders/{decoder_names}`` | :api-ref:`GET /decoders?decoder_names=name <operation/api.controllers.decoder_controller.get_decoders>` | Use the ``decoder_names`` parameter to indicate which decoder to get the information from.                                                                       |
+-------------------------+-----------------------------------+---------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                         |                                   |                                                                                                         | Removed ``download`` parameter. Use :api-ref:`GET /decoders/files/{filename} <operation/api.controllers.decoder_controller.get_file>` instead.                   |
|                         |                                   |                                                                                                         |                                                                                                                                                                  |
| Get all decoders files  | ``GET /decoders/files``           | :api-ref:`GET /decoders/files <operation/api.controllers.decoder_controller.get_decoders_files>`        | Renamed ``file`` parameter in query to ``filename``.                                                                                                             |
|                         |                                   |                                                                                                         |                                                                                                                                                                  |
|                         |                                   |                                                                                                         | Renamed ``path`` parameter in query to ``relative_dirname``.                                                                                                     |
+-------------------------+-----------------------------------+---------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get all parent decoders | ``GET /decoders/parents``         | :api-ref:`GET /decoders/parents <operation/api.controllers.decoder_controller.get_decoders_parents>`    | Added ``select`` parameter in query.                                                                                                                             |
+-------------------------+-----------------------------------+---------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`Experimental <tag/Experimental>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                                   | API 3.x usage                                | API 4.3 usage                                                                                                                     | Changes                                                                                                                                                                           |
+==========================================+==============================================+===================================================================================================================================+===================================================================================================================================================================================+
|                                          |                                              |                                                                                                                                   | Added ``agents_list`` parameter in query.                                                                                                                                         |
| Clear syscheck database                  | ``DELETE /experimental/syscheck``            | :api-ref:`DELETE /experimental/syscheck <operation/api.controllers.experimental_controller.clear_syscheck_database>`              |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | If no ``agents_list`` is provided no agent syschecks will be removed. In order to remove all agent syschecks, it must be specified with the ``all`` keyword.                      |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | This endpoint only works for agents with versions earlier than ``3.12.0``. It doesn't apply to more recent ones since they have an improved database memory management system.    |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                          |                                              |                                                                                                                                   | Added ``agents_list`` parameter in query.                                                                                                                                         |
| Get CIS-CAT results                      | ``GET /experimental/ciscat/results``         | :api-ref:`GET /experimental/ciscat/results <operation/api.controllers.experimental_controller.get_cis_cat_results>`               |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Removed ``agent_id`` parameter in query                                                                                                                                           |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                          |                                              |                                                                                                                                   | Added ``agents_list`` parameter in query.                                                                                                                                         |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``ram_free`` parameter in query to ``ram.free`` and changed its type to integer.                                                                                          |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``ram_total`` parameter in query to ``ram.total`` and changed its type to integer.                                                                                        |
| Get hardware info of all agents          | ``GET /experimental/syscollector/hardware``  | :api-ref:`GET /experimental/syscollector/hardware <operation/api.controllers.experimental_controller.get_hardware_info>`          |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``cpu_cores`` parameter in query to ``cpu.cores`` and changed its type to integer.                                                                                        |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``cpu_mhz`` parameter in query to ``cpu.mhz`` and changed its type to number.                                                                                             |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``cpu_name``  parameter in query to ``cpu.name``.                                                                                                                         |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get network address info of all agents   | ``GET /experimental/syscollector/netaddr``   | :api-ref:`GET /experimental/syscollector/netaddr <operation/api.controllers.experimental_controller.get_network_address_info>`    | Added ``agents_list`` parameter in query.                                                                                                                                         |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                          |                                              |                                                                                                                                   | Added ``agents_list`` parameter in query.                                                                                                                                         |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Changed the type of ``mtu`` parameter to integer.                                                                                                                                 |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``tx_packets`` parameter in query to ``tx.packets`` and changed its type to integer.                                                                                      |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``rx_packets`` parameter in query to ``rx.packets`` and changed its type to integer.                                                                                      |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``tx_bytes`` parameter in query to ``tx.bytes`` and changed its type to integer.                                                                                          |
| Get network interface info of all agents | ``GET /experimental/syscollector/netiface``  | :api-ref:`GET /experimental/syscollector/netiface <operation/api.controllers.experimental_controller.get_network_interface_info>` |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``rx_bytes`` parameter in query to ``rx.bytes`` and changed its type to integer.                                                                                          |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``tx_errors`` parameter in query to ``tx.errors`` and changed its type to integer.                                                                                        |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``rx_errors`` parameter in query to ``rx.errors`` and changed its type to integer.                                                                                        |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``tx_dropped`` parameter in query to ``tx.dropped``  and changed its type to integer.                                                                                     |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``rx_dropped`` parameter in query to ``rx.dropped`` and changed its type to integer.                                                                                      |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get network protocol info of all agents  | ``GET /experimental/syscollector/netproto``  | :api-ref:`GET /experimental/syscollector/netproto <operation/api.controllers.experimental_controller.get_network_protocol_info>`  | Added ``agents_list`` parameter in query.                                                                                                                                         |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                          |                                              |                                                                                                                                   | Added ``agents_list`` parameter in query.                                                                                                                                         |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
| Get os info of all agents                | ``GET /experimental/syscollector/os``        | :api-ref:`GET /experimental/syscollector/os <operation/api.controllers.experimental_controller.get_os_info>`                      | Renamed ``os_name`` parameter in query to ``os.name``.                                                                                                                            |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``os_version`` parameter in query to ``os.version``.                                                                                                                      |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get packages info of all agents          | ``GET /experimental/syscollector/packages``  | :api-ref:`GET /experimental/syscollector/packages <operation/api.controllers.experimental_controller.get_packages_info>`          | Added ``agents_list`` parameter in query.                                                                                                                                         |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                          |                                              |                                                                                                                                   | Added ``agents_list`` parameter in query.                                                                                                                                         |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``local_ip`` parameter to ``local.ip``.                                                                                                                                   |
| Get ports info of all agents             | ``GET /experimental/syscollector/ports``     | :api-ref:`GET /experimental/syscollector/ports <operation/api.controllers.experimental_controller.get_ports_info>`                |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``local_port`` parameter to ``local.port``.                                                                                                                               |
|                                          |                                              |                                                                                                                                   |                                                                                                                                                                                   |
|                                          |                                              |                                                                                                                                   | Renamed ``remote_ip``  parameter to ``remote.ip``.                                                                                                                                |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get processes info of all agents         | ``GET /experimental/syscollector/processes`` | :api-ref:`GET /experimental/syscollector/processes <operation/api.controllers.experimental_controller.get_processes_info>`        | Added ``agents_list`` parameter in query.                                                                                                                                         |
+------------------------------------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`Lists <tag/Lists>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+--------------------------+----------------------+----------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
| Action                   | API 3.x usage        | API 4.3 usage                                                                                | Changes                                                                                  |
+==========================+======================+==============================================================================================+==========================================================================================+
|                          |                      |                                                                                              | Added ``filename`` parameter in query used to filter by filename.                        |
|                          |                      |                                                                                              |                                                                                          |
|                          |                      |                                                                                              | Added ``select`` parameter in query.                                                     |
| Get all lists            | ``GET /lists``       | :api-ref:`GET /lists <operation/api.controllers.cdb_list_controller.get_lists>`              |                                                                                          |
|                          |                      |                                                                                              | Renamed ``path`` parameter in query to ``relative_dirname``.                             |
+--------------------------+----------------------+----------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|                          |                      |                                                                                              | Added ``filename`` parameter in query used to filter by filename.                        |
| Get paths from all lists | ``GET /lists/files`` | :api-ref:`GET /lists/files <operation/api.controllers.cdb_list_controller.get_lists_files>`  |                                                                                          |
|                          |                      |                                                                                              | Added ``relative_dirname`` parameter in query used to filter by relative directory name. |
+--------------------------+----------------------+----------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+


:api-ref:`Manager <tag/Manager>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                           | API 3.x usage                                       | API 4.3 usage                                                                                                                                | Changes                                                                                                                                                                               |
+==================================+=====================================================+==============================================================================================================================================+=======================================================================================================================================================================================+
|                                  |                                                     | :api-ref:`DELETE /decoders/files/{filename} <operation/api.controllers.decoder_controller.delete_file>`                                      |                                                                                                                                                                                       |
|                                  |                                                     |                                                                                                                                              |                                                                                                                                                                                       |
| Delete a local file              | ``DELETE /manager/files``                           | :api-ref:`DELETE /lists/files/{filename} <operation/api.controllers.cdb_list_controller.delete_file>`                                        | Divided into more specific endpoints.                                                                                                                                                 |
|                                  |                                                     |                                                                                                                                              |                                                                                                                                                                                       |
|                                  |                                                     | :api-ref:`DELETE /rules/files/{filename} <operation/api.controllers.rule_controller.delete_file>`                                            |                                                                                                                                                                                       |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get manager active configuration | ``GET /manager/config/{component}/{configuration}`` | :api-ref:`GET /manager/configuration/{component}/{configuration} <operation/api.controllers.manager_controller.get_manager_config_ondemand>` | No changes.                                                                                                                                                                           |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get manager configuration        | ``GET /manager/configuration``                      | :api-ref:`GET /manager/configuration <operation/api.controllers.manager_controller.get_configuration>`                                       | Added parameter ``raw`` to return configuration in XML format.                                                                                                                        |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Check Wazuh configuration        | ``GET /manager/configuration/validation``           | :api-ref:`GET /manager/configuration/validation <operation/api.controllers.manager_controller.get_conf_validation>`                          | No changes.                                                                                                                                                                           |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                  |                                                     | :api-ref:`GET /decoders/files/{filename} <operation/api.controllers.decoder_controller.get_file>`                                            |                                                                                                                                                                                       |
|                                  |                                                     |                                                                                                                                              |                                                                                                                                                                                       |
| Get local file                   | ``GET /manager/files``                              | :api-ref:`GET /lists/files/{filename} <operation/api.controllers.cdb_list_controller.get_file>`                                              | Divided into more specific endpoints.                                                                                                                                                 |
|                                  |                                                     |                                                                                                                                              |                                                                                                                                                                                       |
|                                  |                                                     | :api-ref:`GET /rules/files/{filename} <operation/api.controllers.rule_controller.get_file>`                                                  |                                                                                                                                                                                       |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get manager information          | ``GET /manager/info``                               | :api-ref:`GET /manager/info <operation/api.controllers.manager_controller.get_info>`                                                         | Parameter ``openssl_support`` in response is now a boolean.                                                                                                                           |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get ossec.log                    | ``GET /manager/logs``                               | :api-ref:`GET /manager/logs <operation/api.controllers.manager_controller.get_log>`                                                          | Renamed ``category`` parameter in query to ``tag``.                                                                                                                                   |
|                                  |                                                     |                                                                                                                                              | Renamed ``type_log`` parameter in query to ``level``.                                                                                                                                 |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get summary of ossec.log         | ``GET /manager/logs/summary``                       | :api-ref:`GET /manager/logs/summary <operation/api.controllers.manager_controller.get_log_summary>`                                          | Return a summary of the last 2000 wazuh log entries instead of the last three months.                                                                                                 |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                  |                                                     |                                                                                                                                              | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                            |
| Get manager stats                | ``GET /manager/stats``                              | :api-ref:`GET /manager/stats <operation/api.controllers.manager_controller.get_stats>`                                                       |                                                                                                                                                                                       |
|                                  |                                                     |                                                                                                                                              | Changed date format from YYYYMMDD to YYYY-MM-DD for ``date`` parameter in query.                                                                                                      |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get analysisd stats              | ``GET /manager/stats/analysisd``                    | :api-ref:`GET /manager/stats/analysisd <operation/api.controllers.manager_controller.get_stats_analysisd>`                                   | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                            |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get manager stats per hour       | ``GET /manager/stats/hourly``                       | :api-ref:`GET /manager/stats/hourly <operation/api.controllers.manager_controller.get_stats_hourly>`                                         | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                            |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get remoted stats                | ``GET /manager/stats/remoted``                      | :api-ref:`GET /manager/stats/remoted <operation/api.controllers.manager_controller.get_stats_remoted>`                                       | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                            |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                  |                                                     |                                                                                                                                              | Changed response in order to use an ``affected_items`` and ``failed_items`` response type.                                                                                            |
| Get manager stats per week       | ``GET /manager/stats/weekly``                       | :api-ref:`GET /manager/stats/weekly <operation/api.controllers.manager_controller.get_stats_weekly>`                                         |                                                                                                                                                                                       |
|                                  |                                                     |                                                                                                                                              | Parameter ``hours`` changed to ``averages`` in response body.                                                                                                                         |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get manager status               | ``GET /manager/status``                             | :api-ref:`GET /manager/status <operation/api.controllers.manager_controller.get_status>`                                                     | No changes.                                                                                                                                                                           |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                  |                                                     | :api-ref:`PUT /decoders/files/{filename} <operation/api.controllers.decoder_controller.put_file>`                                            |                                                                                                                                                                                       |
|                                  |                                                     |                                                                                                                                              |                                                                                                                                                                                       |
| Update local file                | ``PUT /manager/files``                              | :api-ref:`PUT /lists/files/{filename} <operation/api.controllers.cdb_list_controller.put_file>`                                              | Divided into more specific endpoints.                                                                                                                                                 |
|                                  |                                                     |                                                                                                                                              |                                                                                                                                                                                       |
|                                  |                                                     | :api-ref:`PUT /rules/files/{filename} <operation/api.controllers.rule_controller.put_file>`                                                  |                                                                                                                                                                                       |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Restart Wazuh manager            | ``PUT /manager/restart``                            | :api-ref:`PUT /manager/restart <operation/api.controllers.manager_controller.put_restart>`                                                   | No changes.                                                                                                                                                                           |
+----------------------------------+-----------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`MITRE <tag/Mitre>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+--------------------------------------------------+------------------------------------+----------------------------------------------------------------------------------------------+-----------------------------------------------+
| Action                                           | API 3.x usage                      | API 4.3 usage                                                                                | Changes                                       |
+==================================================+====================================+==============================================================================================+===============================================+
|                                                  |                                    | :api-ref:`GET /mitre/techniques <operation/api.controllers.mitre_controller.get_techniques>` |                                               |
| Get MITRE information from database              | ``GET /mitre``                     |                                                                                              | Added new endpoints to get MITRE information. |
|                                                  |                                    | :api-ref:`GET /mitre/tactics <operation/api.controllers.mitre_controller.get_tactics>`       |                                               |
+--------------------------------------------------+------------------------------------+----------------------------------------------------------------------------------------------+-----------------------------------------------+


:api-ref:`Rootcheck <tag/Rootcheck>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                               | API 3.x usage                           | API 4.3 usage                                                                                                           | Changes                                                                                                                                                                   |
+======================================+=========================================+=========================================================================================================================+===========================================================================================================================================================================+
| Clear rootcheck database             | ``DELETE /rootcheck``                   | :api-ref:`DELETE /experimental/rootcheck <operation/api.controllers.experimental_controller.clear_rootcheck_database>`  | Added ``agents_list`` parameter in query. In order to remove all rootcheck databases, they must be specified with the ``all`` keyword.                                    |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Clear rootcheck database of an agent | ``DELETE /rootcheck/{agent_id}``        | :api-ref:`DELETE /rootcheck/{agent_id} <operation/api.controllers.rootcheck_controller.delete_rootcheck>`               | No changes.                                                                                                                                                               |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rootcheck database               | ``GET /rootcheck/{agent_id}``           | :api-ref:`GET /rootcheck/{agent_id} <operation/api.controllers.rootcheck_controller.get_rootcheck_agent>`               | Added ``select``, ``distinct`` and ``q`` parameters in query.                                                                                                             |
|                                      |                                         |                                                                                                                         | Renamed ``pci`` parameter to ``pci_dss``.                                                                                                                                 |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rootcheck CIS requirements       | ``GET /rootcheck/{agent_id}/cis``       | :api-ref:`GET /rootcheck/{agent_id} <operation/api.controllers.rootcheck_controller.get_rootcheck_agent>`               | Use ``select`` and ``distinct`` parameters of :api-ref:`GET /rootcheck/{agent_id} <operation/api.controllers.rootcheck_controller.get_rootcheck_agent>` endpoint instead. |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rootcheck pci requirements       | ``GET /rootcheck/{agent_id}/pci``       | :api-ref:`GET /rootcheck/{agent_id} <operation/api.controllers.rootcheck_controller.get_rootcheck_agent>`               | Use ``select`` and ``distinct`` parameters of :api-ref:`GET /rootcheck/{agent_id} <operation/api.controllers.rootcheck_controller.get_rootcheck_agent>` endpoint instead. |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get last rootcheck scan              | ``GET /rootcheck/{agent_id}/last_scan`` | :api-ref:`GET /rootcheck/{agent_id}/last_scan <operation/api.controllers.rootcheck_controller.get_last_scan_agent>`     | No changes.                                                                                                                                                               |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Run rootcheck scan in all agents     | ``PUT /rootcheck``                      | :api-ref:`PUT /rootcheck <operation/api.controllers.rootcheck_controller.put_rootcheck>`                                | Added ``agents_list`` parameter in query.                                                                                                                                 |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Run rootcheck scan in an agent       | ``PUT /rootcheck/{agent_id}``           | :api-ref:`PUT /rootcheck <operation/api.controllers.rootcheck_controller.put_rootcheck>`                                | Use the ``agents_list`` parameter to indicate which agents must run a rootcheck scan.                                                                                     |
+--------------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`Rules <tag/Rules>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                            | API 3.x usage              | API 4.3 usage                                                                                                    | Changes                                                                                                                                                              |
+===================================+============================+==================================================================================================================+======================================================================================================================================================================+
|                                   |                            |                                                                                                                  | Added ``rule_ids`` parameter in query.                                                                                                                               |
|                                   |                            |                                                                                                                  |                                                                                                                                                                      |
|                                   |                            |                                                                                                                  | Added ``select`` parameter in query.                                                                                                                                 |
|                                   |                            |                                                                                                                  |                                                                                                                                                                      |
| Get all rules                     | ``GET /rules``             | :api-ref:`GET /rules <operation/api.controllers.rule_controller.get_rules>`                                      | Renamed ``file`` parameter to ``filename``.                                                                                                                          |
|                                   |                            |                                                                                                                  |                                                                                                                                                                      |
|                                   |                            |                                                                                                                  | Renamed ``pci`` parameter in query to ``pci_dss``.                                                                                                                   |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rules by id                   | ``GET /rules/{rule_id}``   | :api-ref:`GET /rules?rule_ids=rule_id <operation/api.controllers.rule_controller.get_rules>`                     | Use the ``rules_id`` parameter to specify which rules to get the information from.                                                                                   |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                   |                            |                                                                                                                  | Renamed ``path`` parameter in query to ``relative_dirname``.                                                                                                         |
|                                   |                            |                                                                                                                  |                                                                                                                                                                      |
| Get files of rules                | ``GET /rules/files``       | :api-ref:`GET /rules/files <operation/api.controllers.rule_controller.get_rules_files>`                          | Renamed ``file`` parameter in query to ``filename``.                                                                                                                 |
|                                   |                            |                                                                                                                  |                                                                                                                                                                      |
|                                   |                            |                                                                                                                  | Removed ``download`` parameter in query. Use :api-ref:`GET /rules/files/{filename} <operation/api.controllers.rule_controller.get_file>`  instead.                   |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule gdpr requirements        | ``GET /rules/gdpr``        | :api-ref:`GET /rules/requirement/gdpr <operation/api.controllers.rule_controller.get_rules_requirement>`         | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule gpg13 requirements       | ``GET /rules/gpg13``       | :api-ref:`GET /rules/requirement/gpg13 <operation/api.controllers.rule_controller.get_rules_requirement>`        | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule groups                   | ``GET /rules/groups``      | :api-ref:`GET /rules/groups <operation/api.controllers.rule_controller.get_rules_requirement>`                   | No changes.                                                                                                                                                          |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule hipaa requirements       | ``GET /rules/hipaa``       | :api-ref:`GET /rules/requirement/hipaa <operation/api.controllers.rule_controller.get_rules_requirement>`        | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule nist-800-53 requirements | ``GET /rules/nist-800-53`` | :api-ref:`GET /rules/requirement/nist-800-53 <operation/api.controllers.rule_controller.get_rules_requirement>`  | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule pci requirements         | ``GET /rules/pci``         | :api-ref:`GET /rules/requirement/pci_dss <operation/api.controllers.rule_controller.get_rules_requirement>`      | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule tsc requirements         | ``GET /rules/tsc``         | :api-ref:`GET /rules/requirement/tsc <operation/api.controllers.rule_controller.get_rules_requirement>`          | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get rule mitre requirements       | ``GET /rules/mitre``       | :api-ref:`GET /rules/requirement/mitre <operation/api.controllers.rule_controller.get_rules_requirement>`        | Use the new :api-ref:`GET /rules/requirement <operation/api.controllers.rule_controller.get_rules_requirement>` endpoint.                                            |
+-----------------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`Security Assesment Configuration <tag/SCA>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------------------------------------+-------------------+
| Action                                                      | API 3.x usage                              | API 4.3 usage                                                                                               | Changes           |
+=============================================================+============================================+=============================================================================================================+===================+
| Get security configuration assessment (SCA) database        | ``GET /sca/{agent_id}``                    | :api-ref:`GET /sca/{agent_id} <operation/api.controllers.sca_controller.get_sca_agent>`                     | No changes.       |
+-------------------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------------------------------------+-------------------+
| Get security configuration assessment (SCA) checks database | ``GET /sca/{agent_id}/checks/{policy_id}`` | :api-ref:`GET /sca/{agent_id}/checks/{policy_id} <operation/api.controllers.sca_controller.get_sca_checks>` | No changes.       |
+-------------------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------------------------------------+-------------------+


:api-ref:`Summary <tag/Overview>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------------------------+-------------------------+-----------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+
| Action                       | API 3.x usage           | API 4.3 usage                                                                                       | Changes                                                                                                                           |
+==============================+=========================+=====================================================================================================+===================================================================================================================================+
|                              |                         |                                                                                                     | Use the new :api-ref:`GET /overview/agents <operation/api.controllers.overview_controller.get_overview_agents>` endpoint instead. |
| Get a full summary of agents | ``GET /summary/agents`` | :api-ref:`GET /overview/agents <operation/api.controllers.overview_controller.get_overview_agents>` |                                                                                                                                   |
|                              |                         |                                                                                                     | Statuses inside ``agent_status`` in the response no longer start with capital letter.                                             |
+------------------------------+-------------------------+-----------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`Syscheck <tag/Syscheck>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------------------------------+----------------------------------------+-------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Action                              | API 3.x usage                          | API 4.3 usage                                                                                                     | Changes                                                                                                                                                                        |
+=====================================+========================================+===================================================================================================================+================================================================================================================================================================================+
| Clear syscheck database of an agent | ``DELETE /syscheck/{agent_id}``        | :api-ref:`DELETE /syscheck/{agent_id} <operation/api.controllers.syscheck_controller.delete_syscheck_agent>`      | This endpoint only works for agents with versions earlier than ``3.12.0``. It doesn't apply to more recent ones since they have an improved database memory management system. |
+-------------------------------------+----------------------------------------+-------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                     |                                        |                                                                                                                   | New filters ``arch``, ``value.key`` and ``value.name`` for the new response values.                                                                                            |
| Get syscheck files                  | ``GET /syscheck/{agent_id}``           | :api-ref:`GET /syscheck/{agent_id} <operation/api.controllers.syscheck_controller.get_syscheck_agent>`            |                                                                                                                                                                                |
|                                     |                                        |                                                                                                                   | Now the field ``file`` is always returned when using the ``select`` parameter.                                                                                                 |
+-------------------------------------+----------------------------------------+-------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Get last syscheck scan              | ``GET /syscheck/{agent_id}/last_scan`` | :api-ref:`GET /syscheck/{agent_id}/last_scan <operation/api.controllers.syscheck_controller.get_last_scan_agent>` | No changes.                                                                                                                                                                    |
+-------------------------------------+----------------------------------------+-------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Run syscheck scan in all agents     | ``PUT /syscheck``                      | :api-ref:`PUT /syscheck <operation/api.controllers.syscheck_controller.put_syscheck>`                             | No changes.                                                                                                                                                                    |
+-------------------------------------+----------------------------------------+-------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Run syscheck scan in an agent       | ``PUT /syscheck/{agent_id}``           | :api-ref:`PUT /syscheck <operation/api.controllers.syscheck_controller.put_syscheck>`                             | Use the ``agents_list`` parameter to indicate which agents must run a syscheck scan.                                                                                           |
+-------------------------------------+----------------------------------------+-------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


:api-ref:`Syscollector <tag/Syscollector>`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Action                                 | API 3.x usage                              | API 4.3 usage                                                                                                                            | Changes                                                                                        |
+========================================+============================================+==========================================================================================================================================+================================================================================================+
| Get hardware info                      | ``GET /syscollector/{agent_id}/hardware``  | :api-ref:`GET /syscollector/{agent_id}/hardware <operation/api.controllers.syscollector_controller.get_hardware_info>`                   | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Get hotfixes info                      | ``GET /syscollector/{agent_id}/hotfixes``  | :api-ref:`GET /syscollector/{agent_id}/hotfixes <operation/api.controllers.syscollector_controller.get_hotfix_info>`                     | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Get network address info of an agent   | ``GET /syscollector/{agent_id}/netaddr``   | :api-ref:`GET /syscollector/{agent_id}/netaddr <operation/api.controllers.syscollector_controller.get_network_address_info>`             | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
|                                        |                                            |                                                                                                                                          | Changed the type of ``mtu`` parameter to integer.                                              |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``tx_packets`` parameter in query to ``tx.packets`` and changed its type to integer.   |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``rx_packets`` parameter in query to ``rx.packets`` and changed its type to integer.   |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``tx_bytes`` parameter in query to ``tx.bytes`` and changed its type to integer.       |
| Get network interface info of an agent | ``GET /syscollector/{agent_id}/netiface``  | :api-ref:`GET /syscollector/{agent_id}/netiface <operation/api.controllers.syscollector_controller.get_network_interface_info>`          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``rx_bytes`` parameter in query to ``rx.bytes`` and changed its type to integer.       |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``tx_errors`` parameter in query to ``tx.errors`` and changed its type to integer.     |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``rx_errors`` parameter in query to ``rx.errors`` and changed its type to integer.     |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``tx_dropped`` parameter in query to ``tx.dropped``  and changed its type to integer.  |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``rx_dropped`` parameter in query to ``rx.dropped`` and changed its type to integer.   |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Get network protocol info of an agent  | ``GET /syscollector/{agent_id}/netproto``  | :api-ref:`GET /syscollector/{agent_id}/netproto <operation/api.controllers.syscollector_controller.get_network_protocol_info>`           | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Get os info                            | ``GET /syscollector/{agent_id}/os``        | :api-ref:`GET /syscollector/{agent_id}/os <operation/api.controllers.syscollector_controller.get_os_info>`                               | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Get packages info                      | ``GET /syscollector/{agent_id}/packages``  | :api-ref:`GET /syscollector/{agent_id}/packages <operation/api.controllers.syscollector_controller.get_packages_info>`                   | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
|                                        |                                            |                                                                                                                                          | Added ``process`` parameter used to filter by process name.                                    |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``local_ip`` parameter to ``local.ip``.                                                |
| Get ports info of an agent             | ``GET /syscollector/{agent_id}/ports``     | :api-ref:`GET /syscollector/{agent_id}/ports <operation/api.controllers.syscollector_controller.get_ports_info>`                         |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``local_port`` parameter to ``local.port``.                                            |
|                                        |                                            |                                                                                                                                          |                                                                                                |
|                                        |                                            |                                                                                                                                          | Renamed ``remote_ip``  parameter to ``remote.ip``.                                             |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Get processes info                     | ``GET /syscollector/{agent_id}/processes`` | :api-ref:`GET /syscollector/{agent_id}/processes <operation/api.controllers.syscollector_controller.get_processes_info>`                 | No changes.                                                                                    |
+----------------------------------------+--------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
