.. Copyright (C) 2021 Wazuh, Inc.

.. _vuln_detector:

vulnerability-detector
======================

This section covers the configuration for the :ref:`vulnerability-detection` module.

.. topic:: XML section name

	.. code-block:: xml

		<vulnerability-detector>
		</vulnerability-detector>

Options
-------

- `enabled`_
- `interval`_
- `run_on_start`_
- `ignore_time`_
- `provider`_

+---------------------------+-----------------------------+
| Options                   | Allowed values              |
+===========================+=============================+
| `enabled`_                | yes, no                     |
+---------------------------+-----------------------------+
| `interval`_               | A positive number (seconds) |
+---------------------------+-----------------------------+
| `run_on_start`_           | yes, no                     |
+---------------------------+-----------------------------+
| `ignore_time`_            | A positive number (seconds) |
+---------------------------+-----------------------------+
| `provider`_               | A valid vulnerability vendor|
+---------------------------+-----------------------------+


enabled
^^^^^^^^

Enables the module.

+--------------------+-----------------------------+
| **Default value**  | no                          |
+--------------------+-----------------------------+
| **Allowed values** | yes, no                     |
+--------------------+-----------------------------+

.. _vuln_det_interval:

interval
^^^^^^^^

Time between vulnerabilities scans.

+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+
| **Default value**  | 5m                                                                                                                                       |
+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).        |
+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+

.. _vuln_det_run_on_start:

run_on_start
^^^^^^^^^^^^

Runs updates and vulnerabilities scans immediately when service is started.

+----------------------+-----------+
| **Default value**    | yes       |
+----------------------+-----------+
| **Allowed values**   | yes, no   |
+----------------------+-----------+

.. _vuln_det_ignore_time:

ignore_time
^^^^^^^^^^^^

Time during which vulnerabilities that have already been alerted will be ignored. When this time hasn't passed yet, only :ref:`partial scans <vuln_det_scan_types>` will be performed.

+----------------------+------------------------------------------------------------------------------------------------------------------------------------+
| **Default value**    | 6 hours                                                                                                                            |
+----------------------+------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values**   | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).  |
+----------------------+------------------------------------------------------------------------------------------------------------------------------------+

.. note:: In a partial scan new packages are scanned, but only a full scan removes the CVEs related to old packages that are not present anymore.


provider
^^^^^^^^

.. note:: The NVD provider must be always enabled since it aggregates vulnerabilities for all the OS supported. Otherwise, the scanner will not work properly.

Configuration block to specify vulnerability updates.

+--------------------+---------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines a vulnerability information provider.                                                                                                                                                                                                                                                                 |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | canonical                                                                                                                                                                                                                                                                                |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | debian                                                                                                                                                                                                                                                                                   |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|  **Allowed tags**  | name                      | **Allowed values** +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | redhat                                                                                                                                                                                                                                                                                   |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | msu                                                                                                                                                                                                                                                                                      |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | nvd                                                                                                                                                                                                                                                                                      |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
+--------------------+---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** |                           | Enables the vulnerability provider update.                                                                                                                                                                                                                                                                    |
|                    | enabled                   +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Default value**  | no                                                                                                                                                                                                                                                                                       |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | yes, no                                                                                                                                                                                                                                                                                  |
|                    +---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Feed to update.                                                                                                                                                                                                                                                                                               |
|                    | os                        +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **feed**                                                                                                                                                                                                                                                                  |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | trusty / 14                                                                                                                                                                                                                                                               |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | xenial / 16                                                                                                                                                                                                                                                               |
|                    |                           |                    | canonical    +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | bionic / 18                                                                                                                                                                                                                                                               |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | focal / 20                                                                                                                                                                                                                                                                |
|                    |                           | **Allowed values** +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | stretch / 9                                                                                                                                                                                                                                                               |
|                    |                           |                    | debian       +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | buster / 10                                                                                                                                                                                                                                                               |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | 5                                                                                                                                                                                                                                                                         |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | 6                                                                                                                                                                                                                                                                         |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | 7                                                                                                                                                                                                                                                                         |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | 8                                                                                                                                                                                                                                                                         |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | msu          | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | nvd          | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           +--------------------+--------------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed tags**   |                     | How often the vulnerability database is updated. It has priority over the `update_interval` option of the provider block.                                                                                                                                          |
|                    |                           |                    |                     +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | update_interval     | **Default value**  | The value indicated by the `update_interval` option of the provider block.                                                                                                                                                                    |
|                    |                           |                    |                     +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                                                                                             |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines the link to an alternative OVAL files.                                                                                                                                                                                                                     |
|                    |                           |                    | url                 +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | Link to download the OVAL file obtained from `Canonical <https://people.canonical.com/~ubuntu-security/oval>`_ , `Debian <https://www.debian.org/security/oval>`_ or `Red Hat <https://www.redhat.com/security/data/oval/>`_.                 |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines the path to an alternative OVAL file.                                                                                                                                                                                                                      |
|                    |                           |                    | path                +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | Path where the OVAL file obtained from `Canonical <https://people.canonical.com/~ubuntu-security/oval>`_ , `Debian <https://www.debian.org/security/oval>`_ or `Red Hat <https://www.redhat.com/security/data/oval/>`_ is located.            |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines the connection port when using the ``url`` attribute.                                                                                                                                                                                                      |
|                    |                           |                    | port                +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | A valid port.                                                                                                                                                                                                                                 |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines compatibility with unsupported systems.                                                                                                                                                                                                                    |
|                    |                           |                    | allow               +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | A valid operating system not supported by default. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/allow_os>`.                                                                                 |
|                    +---------------------------+--------------------+---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | How often the vulnerabilities of the provider are updated. It can be overwritten by the attribute with the same name of ``<os>``.                                                                                                                                                                             |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | update_interval           | **Default value**  | 1 hour.                                                                                                                                                                                                                                                                                  |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                                                                                                                                        |
|                    +---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Download timeout in seconds.                                                                                                                                                                                                                                                                                  |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | download_timeout          | **Default value**  | 300                                                                                                                                                                                                                                                                                      |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | A positive number to indicate the timeout in seconds.                                                                                                                                                                                                                                    |
|                    +---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Year from which the provider will be updated.                                                                                                                                                                                                                                                                 |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | update_from_year          | **Default value**  | 2010.                                                                                                                                                                                                                                                                                    |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | nvd          |  A valid year greater or equal than 2002.                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | msu          | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    +---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines the link to an alternative feed files.                                                                                                                                                                                                                                                                |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | Parameterized link to download the feed files obtained from `Red Hat Security Data API <https://access.redhat.com/labsinfo/securitydataapi>`_. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/offline_update>`.           |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  url                      | **Allowed values** | nvd          | Parameterized link to download the feed files obtained from `National Vulnerability Database <https://nvd.nist.gov>`_. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/offline_update>`.                                   |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | msu          | Parameterized link to download the feed file obtained from `Wazuh feed <https://feed.wazuh.com/vulnerability-detector/windows/msu-updates.json.gz>`_. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/offline_update>`.    |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | Use the ``url`` attribute of ``<os>`` instead.                                                                                                                                                                                                                            |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | Parameterized link to download the feed files obtained from `Debian Security Tracker <https://security-tracker.debian.org>`_. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/offline_update>`.                            |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the first value which the tag will be substituted.                                                                                                                                                                                                                |
|                    |                           |                    | start        +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                                                |
|                    |                           | **Allowed tags**   +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the last value which the tag will be substituted.                                                                                                                                                                                                                 |
|                    |                           |                    | end          +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                                                |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the connection port.                                                                                                                                                                                                                                              |
|                    |                           |                    | port         +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A valid port.                                                                                                                                                                                                                                        |
|                    +---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines the path to an alternative feed files.                                                                                                                                                                                                                                                                |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       |  Path with regular expression that matches the feed files obtained from `Red Hat Security Data API <https://access.redhat.com/labsinfo/securitydataapi>`_.                                                                                                                |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  path                     | **Allowed values** | nvd          |  Path with regular expression that matches the feed files obtained from `National Vulnerability Database <https://nvd.nist.gov>`_.                                                                                                                                        |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | msu          |  Path with regular expression that matches the feed file obtained from `Wazuh feed <https://feed.wazuh.com/vulnerability-detector/windows/msu-updates.json.gz>`_.                                                                                                         |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    |  Use the ``path`` attribute of ``<os>`` instead.                                                                                                                                                                                                                          |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       |  Path with regular expression that matches the feed files obtained from `Debian Security Tracker <https://security-tracker.debian.org>`_.                                                                                                                                 |
+--------------------+---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Example of configuration
------------------------

The following configuration will update the vulnerability database for Ubuntu, Debian, Redhat and Microsoft Windows.

.. code-block:: xml

    <vulnerability-detector>
        <enabled>no</enabled>
        <interval>5m</interval>
        <ignore_time>6h</ignore_time>
        <run_on_start>yes</run_on_start>

        <!-- Ubuntu OS vulnerabilities -->
        <provider name="canonical">
          <enabled>no</enabled>
          <os>trusty</os>
          <os>xenial</os>
          <os>bionic</os>
          <os>focal</os>
          <update_interval>1h</update_interval>
        </provider>

        <!-- Debian OS vulnerabilities -->
        <provider name="debian">
          <enabled>no</enabled>
          <os>stretch</os>
          <os>buster</os>
          <update_interval>1h</update_interval>
        </provider>

        <!-- RedHat OS vulnerabilities -->
        <provider name="redhat">
          <enabled>no</enabled>
          <os>5</os>
          <os>6</os>
          <os>7</os>
          <os>8</os>
          <update_interval>1h</update_interval>
        </provider>

        <!-- Windows OS vulnerabilities -->
        <provider name="msu">
          <enabled>yes</enabled>
          <update_interval>1h</update_interval>
        </provider>

        <!-- Aggregate vulnerabilities -->
        <provider name="nvd">
          <enabled>yes</enabled>
          <update_from_year>2010</update_from_year>
          <update_interval>1h</update_interval>
        </provider>

    </vulnerability-detector>


.. note:: See the :doc:`Vulnerability detector section<../../capabilities/vulnerability-detection/index>` to obtain more information about this module.
