.. Copyright (C) 2019 Wazuh, Inc.

.. _vuln_detector:

vulnerability-detector
======================

.. versionadded:: 3.2.0

This section covers the configuration for the :ref:`vulnerability-detection` module.

.. topic:: XML section name

	.. code-block:: xml

		<vulnerability-detector>
		</vulnerability-detector>

Options
-------

- `enabled`_
- `interval`_
- `run_on_start`_
- `ignore_time`_
- `provider`_

.. note:: The options ``update_ubuntu_oval``/``update_redhat_oval`` (since 3.5) and ``feed`` (since 3.11) are deprecated. It is recommended to use ``provider`` instead.

+---------------------------+-----------------------------+
| Options                   | Allowed values              |
+===========================+=============================+
| `enabled`_                | yes, no                     |
+---------------------------+-----------------------------+
| `interval`_               | A positive number (seconds) |
+---------------------------+-----------------------------+
| `run_on_start`_           | yes, no                     |
+---------------------------+-----------------------------+
| `ignore_time`_            | A positive number (seconds) |
+---------------------------+-----------------------------+
| `provider`_               | A valid vulnerability vendor|
+---------------------------+-----------------------------+


enabled
^^^^^^^^

Enables the module.

+--------------------+-----------------------------+
| **Default value**  | no                          |
+--------------------+-----------------------------+
| **Allowed values** | yes, no                     |
+--------------------+-----------------------------+

interval
^^^^^^^^

Time between vulnerabilities scans.

+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+
| **Default value**  | 5m                                                                                                                                       |
+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).        |
+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+

run_on_start
^^^^^^^^^^^^

Runs updates and vulnerabilities scans immediately when service is started.

+----------------------+-----------+
| **Default value**    | yes       |
+----------------------+-----------+
| **Allowed values**   | yes, no   |
+----------------------+-----------+

ignore_time
^^^^^^^^^^^^

Time during which vulnerabilities that have already been alerted will be ignored.

+----------------------+------------------------------------------------------------------------------------------------------------------------------------+
| **Default value**    | 6 hours                                                                                                                            |
+----------------------+------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values**   | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).  |
+----------------------+------------------------------------------------------------------------------------------------------------------------------------+

provider
^^^^^^^^

Configuration block to specify vulnerability updates.

+--------------------+---------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines a vulnerability information provider.                                                                                                                                                                                                                                                                 |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | canonical                                                                                                                                                                                                                                                                                |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | debian                                                                                                                                                                                                                                                                                   |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|  **Allowed tags**  | name                      | **Allowed values** +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | redhat                                                                                                                                                                                                                                                                                   |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
|                    |                           |                    | nvd                                                                                                                                                                                                                                                                                      |
|                    |                           |                    |                                                                                                                                                                                                                                                                                          |
+--------------------+---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** |                           | Enables the vulnerability provider update.                                                                                                                                                                                                                                                                    |
|                    | enabled                   +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Default value**  | no                                                                                                                                                                                                                                                                                       |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | yes, no                                                                                                                                                                                                                                                                                  |
|                    +---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Feed to update.                                                                                                                                                                                                                                                                                               |
|                    | os                        +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **feed**                                                                                                                                                                                                                                                                  |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | precise / 12                                                                                                                                                                                                                                                              |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | trusty / 14                                                                                                                                                                                                                                                               |
|                    |                           |                    | canonical    +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | xenial / 16                                                                                                                                                                                                                                                               |
|                    |                           | **Allowed values** |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | bionic / 18                                                                                                                                                                                                                                                               |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | wheezy / 7                                                                                                                                                                                                                                                                |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | jessie / 8                                                                                                                                                                                                                                                                |
|                    |                           |                    |              +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | stretch / 9                                                                                                                                                                                                                                                               |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | nvd          | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           +--------------------+--------------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed tags**   |                     | How often the vulnerability database is updated. It has priority over the `update_interval` option of the provider block.                                                                                                                                          |
|                    |                           |                    |                     +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | update_interval     | **Default value**  | The value indicated by the `update_interval` option of the provider block.                                                                                                                                                                    |
|                    |                           |                    |                     +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                                                                                             |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines the link to an alternative OVAL files.                                                                                                                                                                                                                     |
|                    |                           |                    | url                 +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | Link to download the OVAL file obtained from `Canonical <https://people.canonical.com/~ubuntu-security/oval>`_ or `Debian <https://www.debian.org/security/oval>`_.                                                                           |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines the path to an alternative OVAL file.                                                                                                                                                                                                                      |
|                    |                           |                    | path                +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | Path where the OVAL file obtained from `Canonical <https://people.canonical.com/~ubuntu-security/oval>`_ or `Debian <https://www.debian.org/security/oval>`_ is located.                                                                      |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines the connection port when using the ``url`` attribute.                                                                                                                                                                                                      |
|                    |                           |                    | port                +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | A valid port.                                                                                                                                                                                                                                 |
|                    |                           |                    +---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | Defines compatibility with unsupported systems.                                                                                                                                                                                                                    |
|                    |                           |                    | allow               +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                     | **Allowed values** | A valid operating system not supported by default. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/allow_os>`.                                                                                 |
|                    +---------------------------+--------------------+---------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | How often the vulnerabilities of the provider are updated. It can be overwritten by the attribute with the same name of ``<os>``.                                                                                                                                                                             |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | update_interval           | **Default value**  | 1 hour.                                                                                                                                                                                                                                                                                  |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                                                                                                                                        |
|                    +---------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Year from which the provider will be updated.                                                                                                                                                                                                                                                                 |
|                    |                           +--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | update_from_year          | **Default value**  | 2010.                                                                                                                                                                                                                                                                                    |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       |  A valid year and greater than 1998.                                                                                                                                                                                                                                      |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | nvd          |  A valid year and greater than 2001.                                                                                                                                                                                                                                      |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    +---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines compatibility with unsupported systems.                                                                                                                                                                                                                                                               |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | A valid operating system not supported by default. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/allow_os>`.                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  allow                    | **Allowed values** | nvd          | ``Does not use this option.``                                                                                                                                                                                                                                             |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | Use the ``allow`` attribute of ``<os>`` instead.                                                                                                                                                                                                                          |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | Use the ``allow`` attribute of ``<os>`` instead.                                                                                                                                                                                                                          |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the version of Red Hat that will replace the unsupported system.                                                                                                                                                                                                  |
|                    |                           | **Allowed tags**   | replaced_os  +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                                                |
|                    +---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines the link to an alternative feed files.                                                                                                                                                                                                                                                                |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | Parameterized link to download the feed files obtained from `Red Hat Security Data API <https://access.redhat.com/labsinfo/securitydataapi>`_. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/offline_update>`.           |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  url                      | **Allowed values** | nvd          | Parameterized link to download the feed files obtained from `National Vulnerability Database <https://nvd.nist.gov>`_. You can find a guide on how to set it up :doc:`here<../../capabilities/vulnerability-detection/offline_update>`.                                   |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | Use the ``url`` attribute of ``<os>`` instead.                                                                                                                                                                                                                            |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | Use the ``url`` attribute of ``<os>`` instead.                                                                                                                                                                                                                            |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the first value which the tag will be substituted.                                                                                                                                                                                                                |
|                    |                           |                    | start        +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                                                |
|                    |                           | **Allowed tags**   +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the last value which the tag will be substituted.                                                                                                                                                                                                                 |
|                    |                           |                    | end          +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                                                |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Defines the connection port.                                                                                                                                                                                                                                              |
|                    |                           |                    | port         +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A valid port.                                                                                                                                                                                                                                        |
|                    +---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Defines the path to an alternative feed files.                                                                                                                                                                                                                                                                |
|                    |                           +--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       |  Path with regular expression that matches the feed files obtained from `Red Hat Security Data API <https://access.redhat.com/labsinfo/securitydataapi>`_.                                                                                                                |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  path                     | **Allowed values** | nvd          |  Path with regular expression that matches the feed files obtained from `National Vulnerability Database <https://nvd.nist.gov>`_.                                                                                                                                        |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    |  Use the ``path`` attribute of ``<os>`` instead.                                                                                                                                                                                                                          |
|                    |                           |                    +--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       |  Use the ``path`` attribute of ``<os>`` instead.                                                                                                                                                                                                                          |
+--------------------+---------------------------+--------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Example of configuration
------------------------

The following configuration will update the vulnerability database for Debian 9 with a day of interval,
Red Hat from 2013, Ubuntu Bionic from a local file, Ubuntu Xenial from a local repository, and the
National Vulnerability Database from local files. It also allows you to extract vulnerabilities from agents with
Linux Mint 18.X and Pop OS 18 using the Ubuntu 18 vulnerability database, or Oracle Linux 6 agents using the Red Hat feed.


.. code-block:: xml

    <vulnerability-detector>
        <enabled>yes</enabled>
        <interval>5m</interval>
        <run_on_start>yes</run_on_start>

        <provider name="debian">
            <enabled>yes</enabled>
            <os interval="1d">9</os>
        </provider>

        <provider name="redhat">
            <enabled>yes</enabled>
            <update_from_year>2013</update_from_year>
            <update_interval>20h</update_interval>
            <allow replaced_os="Red Hat-6">Oracle Linux-6</allow>
        </provider>

        <provider name="canonical">
            <enabled>no</enabled>
            <os path="/local/feeds/oval/bionic_oval.xml" allow="linux mint-18, pop!_os-18">bionic</os>
            <os url="http://my_local_repo/xenial_oval.xml">xenial</os>
            <update_interval>1h</update_interval>
        </provider>
        
        <provider name="nvd">
            <enabled>no</enabled>
            <path>/local/feeds/nvd/nvdcve-1.0-.*json.gz$</path>
        </provider>
    </vulnerability-detector>

.. note:: See the :doc:`Vulnerability detector section<../../capabilities/vulnerability-detection/index>` to obtain more information about this module.
