.. Copyright (C) 2019 Wazuh, Inc.

.. _reference_ossec_logging:

logging
=======

.. topic:: XML section name

    .. code-block:: xml

      <logging>
      </logging>

This section shows how to configure the output of the three types of Wazuh logs (archives, alerts and ossec).

Logs compatibility
------------------

The following table shows where these log are available, in plain text and JSON format.

+-------------+----------------------+
| Log file    | Install type         |
+=============+======================+
| ossec       | manager / agent      |
+-------------+----------------------+
| alerts      | manager              |
+-------------+----------------------+
| archives    | manager              |
+-------------+----------------------+

Options
-------

- `log_format`_
- `log`_
- `alerts`_
- `archives`_

log_format
^^^^^^^^^^

.. deprecated:: 3.12.0

Specifies the log format between JSON output (.json) or plain text (.log). It also can be set to output both formats at the same time, when both are formats are entered, separated by a comma.

Depending on the given format, the output file will be ``/var/ossec/logs/ossec.log``, ``/var/ossec/logs/ossec.json`` or both of them.

+--------------------+----------------+
| **Default value**  | plain          |
+--------------------+----------------+
| **Allowed values** | - plain        |
|                    | - json         |
|                    | - plain, json  |
+--------------------+----------------+

.. note:: Use the ``logs`` instead.

log
^^^

Configures the output of standard Wazuh logs (``ossec.log`` and ``ossec.json`` files).

Options:

+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   enabled          | Enable or disable this log output.                                                                                                                                                                                                                                                             |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed values** | yes, no                                                                                                                                                                                                                                                                   |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Default value**  | no                                                                                                                                                                                                                                                                        |
+--------------------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   format           | Sets the output format.                                                                                                                                                                                                                                                                        |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed values** | - plain (to write in ``ossec.log``)                                                                                                                                                                                                                                       |
|                    |                    | - json (to write in ``ossec.json``)                                                                                                                                                                                                                                       |
|                    |                    | - json,plain (to write in both files)                                                                                                                                                                                                                                     |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Default value**  | plain                                                                                                                                                                                                                                                                     |
+--------------------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   rotation         | Configure the log rotation.                                                                                                                                                                                                                                                                    |
|                    +---------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed options** |                       | Enable or disable log rotation.                                                                                                                                                                                                                  |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   enabled             | **Allowed values** | yes, no                                                                                                                                                                                                                     |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | yes                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation schedule.                                                                                                                                                                                                                 |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   schedule            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: m (minutes) or h (hours). Also week days are accepted: monday, tuesday, wednesday, etc.                                                    |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 24h                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the log compression.                                                                                                                                                                                                                   |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   compress            | **Allowed values** | yes, no                                                                                                                                                                                                                     |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | yes                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation by size. The log will be rotated when it grows bigger than the size indicated in this option.                                                                                                                             |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   max_size            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: B (byte), K (kilobyte), M (megabyte) or G (gigabyte).                                                                                      |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 0 (rotation by size disabled)                                                                                                                                                                                               |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation by size and schedule. The log will be rotated if `schedule` is met and the log has grown bigger than the size indicated in this options.                                                                                  |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   min_size            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: B (byte), K (kilobyte), M (megabyte) or G (gigabyte).                                                                                      |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 0 (rotation by size disabled)                                                                                                                                                                                               |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Maximum number of rotated logs that will be maintained for each format.                                                                                                                                                                          |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   rotate              | **Allowed values** | A number greater than or equal to 1, or -1 to disable log cleaning.                                                                                                                                                         |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | -1 (log cleaning disabled)                                                                                                                                                                                                  |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Number of days to keep the logs.                                                                                                                                                                                                                 |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   maxage              | **Allowed values** | A positive number that indicates the number of days to keep the logs.                                                                                                                                                       |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 31                                                                                                                                                                                                                          |
+--------------------+---------------------+-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

alerts
^^^^^^

Configures the output of Wazuh alerts (``alerts.log`` and ``alerts.json`` files).

Options:

+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   enabled          | Enable or disable this alerts output.                                                                                                                                                                                                                                                          |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed values** | yes, no                                                                                                                                                                                                                                                                   |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Default value**  | no                                                                                                                                                                                                                                                                        |
+--------------------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   format           | Sets the output format.                                                                                                                                                                                                                                                                        |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed values** | - plain (to write in ``alerts.log``)                                                                                                                                                                                                                                      |
|                    |                    | - json (to write in ``alerts.json``)                                                                                                                                                                                                                                      |
|                    |                    | - json,plain (to write in both files)                                                                                                                                                                                                                                     |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Default value**  | json,plain                                                                                                                                                                                                                                                                |
+--------------------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   rotation         | Configure the alerts rotation.                                                                                                                                                                                                                                                                 |
|                    +---------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed options** |                       | Enable or disable log rotation.                                                                                                                                                                                                                  |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   enabled             | **Allowed values** | yes, no                                                                                                                                                                                                                     |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | yes                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation schedule.                                                                                                                                                                                                                 |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   schedule            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: m (minutes) or h (hours). Also week days are accepted: monday, tuesday, wednesday, etc.                                                    |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 24h                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the alerts compression.                                                                                                                                                                                                                |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   compress            | **Allowed values** | yes, no                                                                                                                                                                                                                     |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | yes                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation by size. The log will be rotated when it grows bigger than the size indicated in this option.                                                                                                                             |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   max_size            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: B (byte), K (kilobyte), M (megabyte) or G (gigabyte).                                                                                      |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 0 (rotation by size disabled)                                                                                                                                                                                               |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation by size and schedule. The log will be rotated if `schedule` is met and the log has grown bigger than the size indicated in this options.                                                                                  |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   min_size            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: B (byte), K (kilobyte), M (megabyte) or G (gigabyte).                                                                                      |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 0 (rotation by size disabled)                                                                                                                                                                                               |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Maximum number of rotated logs that will be maintained for each format.                                                                                                                                                                          |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   rotate              | **Allowed values** | A number greater than or equal to 1, or -1 to disable log cleaning.                                                                                                                                                         |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | -1 (log cleaning disabled)                                                                                                                                                                                                  |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Number of days to keep the logs.                                                                                                                                                                                                                 |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   maxage              | **Allowed values** | A positive number that indicates the number of days to keep the logs.                                                                                                                                                       |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 31                                                                                                                                                                                                                          |
+--------------------+---------------------+-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

archives
^^^^^^^^

Configures the output of Wazuh archives logs (``archives.log`` and ``archives.json`` files).

Options:

+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   enabled          | Enable or disable this log output.                                                                                                                                                                                                                                                             |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed values** | yes, no                                                                                                                                                                                                                                                                   |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Default value**  | no                                                                                                                                                                                                                                                                        |
+--------------------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   format           | Sets the output format.                                                                                                                                                                                                                                                                        |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed values** | - plain (to write in ``archives.log``)                                                                                                                                                                                                                                    |
|                    |                    | - json (to write in ``archives.json``)                                                                                                                                                                                                                                    |
|                    |                    | - json,plain (to write in both files)                                                                                                                                                                                                                                     |
|                    +--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Default value**  | None                                                                                                                                                                                                                                                                      |
+--------------------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|   rotation         | Configure the log rotation.                                                                                                                                                                                                                                                                    |
|                    +---------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | **Allowed options** |                       | Enable or disable log rotation.                                                                                                                                                                                                                  |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   enabled             | **Allowed values** | yes, no                                                                                                                                                                                                                     |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | yes                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation schedule.                                                                                                                                                                                                                 |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   schedule            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: m (minutes) or h (hours). Also week days are accepted: monday, tuesday, wednesday, etc.                                                    |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 24h                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the log compression.                                                                                                                                                                                                                   |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   compress            | **Allowed values** | yes, no                                                                                                                                                                                                                     |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | yes                                                                                                                                                                                                                         |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation by size. The log will be rotated when it grows bigger than the size indicated in this option.                                                                                                                             |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   max_size            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: B (byte), K (kilobyte), M (megabyte) or G (gigabyte).                                                                                      |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 0 (rotation by size disabled)                                                                                                                                                                                               |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Configure the rotation by size and schedule. The log will be rotated if `schedule` is met and the log has grown bigger than the size indicated in this options.                                                                                  |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   min_size            | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: B (byte), K (kilobyte), M (megabyte) or G (gigabyte).                                                                                      |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 0 (rotation by size disabled)                                                                                                                                                                                               |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Maximum number of rotated logs that will be maintained for each format.                                                                                                                                                                          |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   rotate              | **Allowed values** | A number greater than or equal to 1, or -1 to disable log cleaning.                                                                                                                                                         |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | -1 (log cleaning disabled)                                                                                                                                                                                                  |
|                    |                     +-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | Number of days to keep the logs.                                                                                                                                                                                                                 |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |   maxage              | **Allowed values** | A positive number that indicates the number of days to keep the logs.                                                                                                                                                       |
|                    |                     |                       +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                     |                       | **Default value**  | 31                                                                                                                                                                                                                          |
+--------------------+---------------------+-----------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. note:: The `schedule` indicated must be a day divisor (except week days). This means that not every value is accepted. For example, a day can be divided into 30-minutes fractions but it cannot be divided into 7-hour fractions. This is done in order to rotate at fixed hours.

.. warning:: The minimum size that can be specified as `max_size` or `min_size` is `1 MB`.

.. warning:: The options `max_size` and `min_size` cannot be combined.

Default configuration
---------------------

.. code-block:: xml

  <logging>
    <log>
      <enabled>yes</enabled>
      <format>json,plain</format>
      <rotation>
        <enabled>yes</enabled>
        <interval>24h</interval>
        <compress>yes</compress>
      </rotation>
    </log>
    <alerts>
      <enabled>yes</enabled>
      <format>json,plain</format>
      <rotation>
        <enabled>yes</enabled>
        <interval>24h</interval>
        <compress>yes</compress>
      </rotation>
    </alerts>
    <archives>
      <enabled>yes</enabled>
      <format>json,plain</format>
      <rotation>
        <enabled>yes</enabled>
        <interval>24h</interval>
        <compress>yes</compress>
      </rotation>
    </archives>
  </logging>
