.. Copyright (C) 2018 Wazuh, Inc.

.. _syscollector:

System inventory
================

The Wazuh agents are able to collect interesting system information and store it into a DB for each agent on the manager side. The `Syscollector` module is in charge of this collection.

- `How it works`_
- `Available scans`_
    - `Hardware`_
    - `Operating System`_
    - `Network interfaces`_
    - `Packages`_
    - `Ports`_
    - `Processes`_
- `Compatibility matrix`_
- `Use case: Visualize system inventory in the Wazuh App`_

How it works
-------------

As mentioned above, this module tries to gather the most relevant information from the monitored system.

Once the agent starts, `Syscollector` runs periodically scans of defined targets (hardware, OS, packages, etc.), forwarding the new collected data to the manager who updates the appropriate tables of the database.

The agent inventory is gathered for different goals. The entire inventory can be found at the `inventory` tab of the Wazuh APP for each agent, by querying the API to retrieve the data from the DB. It is also available the `Dev tools` tab
where it can be queried the API directly about the different scans being able to filter by any desired field.

In addition, the packages inventory is used as packages feed for the :doc:`Vulnerability detector module<./vulnerability-detection>`.

Available scans
---------------

The collected information from Wazuh agents are stored in different SQLite tables. Here is described the content of each available table.

At present, this module is available for Linux, Windows, MacOS, OpenBS and FreeBSD.

Hardware
^^^^^^^^

Retrieve basic information about the hardware components of a system.

+------------------+-----------------------------+-------------------------------------------+-------------------+
| Field            | Description                 | Example                                   | Available         |
+==================+=============================+===========================================+===================+
| **scan_id**      | Scan identifier             | 573872577                                 | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **scan_time**    | Scan date                   | 2018/07/31 15:31:26                       | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **board_serial** | Motherboard serial number   | XDR840TUGM65E03171                        | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **cpu_name**     | CPU name                    | Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **cpu_cores**    | Number of cores of the CPU  | 4                                         | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **cpu_mhz**      | Current proccesor frequency | 900.106                                   | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **ram_total**    | Total RAM (KB)              | 16374572                                  | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **ram_free**     | Free RAM (KB)               | 2111928                                   | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **ram_usage**    | Percentaje of RAM in use    | 87                                        | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+

Operating system
^^^^^^^^^^^^^^^^^

Retrieve basic information about the Operating System.

+------------------+-------------------------+-----------------------------------------------------+-------------------+
| Field            | Description             | Example                                             | Available         |
+==================+=========================+=====================================================+===================+
| **scan_id**      | Scan identifier         | 468455719                                           | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **scan_time**    | Scan date               | 2018/07/31 15:31:26                                 | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **hostname**     | Hostname of the machine | ag-ubuntu-16                                        | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **architecture** | OS arquitecture         | x86_64                                              | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_name**      | OS name                 | Ubuntu                                              | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_version**   | OS version              | 16.04.5 LTS (Xenial Xerus)                          | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_codename**  | OS version codename     | Xenial Xerus                                        | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_major**     | Major release version   | 16                                                  | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_minor**     | Minor release version   | 04                                                  | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_build**     | Optional build-specific | 14393                                               | Windows           |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_platform**  | OS platform             | ubuntu                                              | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **sysname**      | System name             | Linux                                               | Linux             |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **release**      | Release name            | 4.15.0-29-generic                                   | Linux             |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **version**      | Release version         | #31~16.04.1-Ubuntu SMP Wed Jul 18 08:54:04 UTC 2018 | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+


Packages
^^^^^^^^

The currently packages inventory of each Wazuh agent. On Linux systems, retrieved packages can be `deb` or `rpm` types.

+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field            | Description                            | Example                                           | Available         |
+==================+========================================+===================================================+===================+
| **scan_id**      | Scan identifier                        | 1454946158                                        | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**    | Scan date                              | 2018/07/27 07:27:14                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **format**       | Format of the package                  | deb                                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **name**         | Name of the package                    | linux-headers-generic                             | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **priority**     | Priority of the package                | optional                                          | deb               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **section**      | Section of the package                 | kernel                                            | deb/rpm/pkg       |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **size**         | Size of the installed package in bytes | 14                                                | deb/rpm           |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **vendor**       | Vendor name                            | Ubuntu Kernel Team                                | deb/rpm/win       |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **install_time** | Date when the package was installed    | 2018/02/08 18:45:48                               | rpm/win           |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **version**      | Version of the package                 | 4.4.0.130.136                                     | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **architecture** | Architecture of the package            | amd64                                             | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **multiarch**    | Multiarchitecture support              | same                                              | deb               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **source**       | Source of the package                  | linux-meta                                        | deb/rpm/pkg       |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **description**  | Description of the package             | Generic Linux kernel headers                      | deb/rpm/pkg       |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **location**     | Location of the package                | C:\\Program Files\\VMware\\VMware Tools\\         | win/pkg           |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+


Network interfaces
^^^^^^^^^^^^^^^^^^

The network interfaces scan retrieves information about the existing network interface of a system (up and down interfaces) as well as their routing configuration,
it is composed of three tables to ensure that the information is as structured as possible.

- `sys_netiface` table

+------------------+------------------------------+-----------------------------------------------------+-------------------+
| Field            | Description                  | Example                                             | Available         |
+==================+==============================+=====================================================+===================+
| **id**           | Id                           | 1                                                   | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier              | 160615720                                           | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **scan_time**    | Scan date                    | 2018/07/31 16:46:20                                 | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **name**         | Interface name               | eth0                                                | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **adapter**      | Physical adapter name        | Intel(R) PRO/1000 MT Desktop Adapter                | Windows           |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **type**         | Network adapter              | ethernet                                            | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **state**        | State of the interface       | up                                                  | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **mtu**          | Maximum Transmission Unit    | 1500                                                | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **mac**          | MAC Address                  | 08:00:27:C0:14:A5                                   | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **tx_packets**   | Transmitted packets          | 30279                                               | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **rx_packets**   | Received packets             | 12754                                               | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **tx_bytes**     | Transmitted bytes            | 10034626                                            | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **rx_bytes**     | Received bytes               | 1111175                                             | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **tx_errors**    | Transmission errors          | 0                                                   | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **rx_errors**    | Reception errors             | 0                                                   | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **tx_dropped**   | Dropped transmission packets | 0                                                   | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+
| **rx_dropped**   | Dropped reception packets    | 0                                                   | All               |
+------------------+------------------------------+-----------------------------------------------------+-------------------+

- `sys_netaddr` table

Referencing interfaces described at `sys_netiface`, this table shows the IPv4 and IPv6 addresses associated to that interfaces.

+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| Field            | Description                     | Example                                             | Available         |
+==================+=================================+=====================================================+===================+
| **id**           | Referenced id from sys_netiface | 1                                                   | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier                 | 160615720                                           | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **proto**        | Protocol name                   | ipv4                                                | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **address**      | IPv4/IPv6 address               | 192.168.1.87                                        | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **netmask**      | Netmask address                 | 255.255.255.0                                       | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **broadcast**    | Broadcast address               | 192.168.1.255                                       | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+

- `sys_netproto` table

Referencing interfaces described at `sys_netiface`, this table shows the routing configuration for each interface.

+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| Field            | Description                     | Example                                             | Available         |
+==================+=================================+=====================================================+===================+
| **id**           | Referenced id from sys_netiface | 1                                                   | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier                 | 160615720                                           | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **iface**        | Interface name                  | eth0                                                | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **type**         | Protocol of the interface data  | ipv4                                                | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **gateway**      | Default gateway                 | 192.168.1.1                                         | Linux/Windows     |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **dhcp**         | DHCP status                     | enabled                                             | Linux/Windows     |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+


Ports
^^^^^

 List the opened ports of a system.

+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field            | Description                            | Example                                           | Available         |
+==================+========================================+===================================================+===================+
| **scan_id**      | Scan identifier                        | 1618114744                                        | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**    | Scan date                              | 2018/07/27 07:27:15                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **protocol**     | Protocol of the port                   | tcp                                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **local_ip**     | Local IP                               | 0.0.0.0                                           | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **local_port**   | Local port                             | 22                                                | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **remote_ip**    | Remote IP                              | 0.0.0.0                                           | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **remote_port**  | Remote port                            | 0                                                 | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tx_queue**     | Packets pending to be transmitted      | 0                                                 | Linux             |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **rx_queue**     | Packets at the receiver queue          | 0                                                 | Linux             |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **inode**        | Inode of the port                      | 16974                                             | Linux             |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **state**        | State of the port                      | listening                                         | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **PID**          | PID owner of the opened port           | 4                                                 | Windows           |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **process**      | Name of the PID                        | System                                            | Windows           |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+


Processes
^^^^^^^^^

 List the current processes running in a system host.

+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field           | Description                            | Example                                           | Available         |
+=================+========================================+===================================================+===================+
| **scan_id**     | Scan identifier                        | 215303769                                         | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**   | Scan date                              | 2018/08/03 12:57:58                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **pid**         | PID of the process                     | 603                                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **name**        | Name of the process                    | rsyslogd                                          | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **state**       | State of the process                   | S                                                 | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **ppid**        | PPID of the process                    | 1                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **utime**       | Time spent executing user code         | 157                                               | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **stime**       | Time spent executing system code       | 221                                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **cmd**         | Command executed                       | /usr/sbin/rsyslogd                                | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **argvs**       | Arguments of the process               | -n                                                | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **euser**       | Effective user                         | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **ruser**       | Real user                              | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **suser**       | Saved-set user                         | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **egroup**      | Effective group                        | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **rgroup**      | Real group                             | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **sgroup**      | Saved-set group                        | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **fgroup**      | Filesystem group name                  | root                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **priority**    | Kernel scheduling priority             | 20                                                | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **nice**        | Nice value of the process              | 0                                                 | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **size**        | Size of the process                    | 53030                                             | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **vm_size**     | Total VM size (KB)                     | 212120                                            | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **resident**    | Residen size of the process in bytes   | 902                                               | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **share**       | Shared memory                          | 814                                               | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **start_time**  | Time when the process started          | 1893                                              | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **pgrp**        | Process group                          | 603                                               | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **session**     | Session of the process                 | 603                                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **nlwp**        | Number of light weight processes       | 3                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tgid**        | Thread Group ID                        | 603                                               | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tty**         | Number of TTY of the process           | 0                                                 | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **processor**   | Number of the processor                | 0                                                 | Linux             |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+


Compatibility matrix
---------------------

The following table shows the scans compatibility for the different available Operating Systems:

+------------------------+----------------------------------------------------------------------+
|                        |                      **Syscollector scan**                           |
+  **Operating System**  +-----------+-----------+-----------+----------+-----------+-----------+
|                        |  Hardware |    OS     |  Packages |  Network |   Ports   | Processes |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    Windows             |     ✓     |     ✓     |     ✓     |     ✓    |     ✓     |     ✓     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    Linux               |     ✓     |     ✓     |     ✓     |     ✓    |     ✓     |     ✓     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    macOS               |     ✓     |     ✓     |     ✓     |     ✓    |     ✗     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    FreeBSD             |     ✓     |     ✓     |     ✓     |     ✓    |     ✗     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    OpenBSD             |     ✓     |     ✓     |     ✗     |     ✓    |     ✗     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+


Use case: Visualize system inventory in the Wazuh App
-----------------------------------------------------
