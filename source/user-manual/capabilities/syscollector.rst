.. Copyright (C) 2018 Wazuh, Inc.

.. _syscollector:

System inventory
================

The Wazuh agents are able to collect interesting system information and store it into a DB for each agent on the manager side. The `Syscollector` module is in charge of this collection.

- `Available scans`_
    - Hardware
    - Operating System
    - Network interfaces
    - Packages
    - Ports
    - Processes
- `Compatibility matrix`_
- `How it works`_
- `Use case: Visualize system inventory in the Wazuh App`_

Available scans
---------------

The collected information from Wazuh agents are stored in different SQLite tables. Here is described the content of each available table.

The scan are available in Linux, Windows, MacOS, OpenBS and FreeBSD.

Hardware
^^^^^^^^

Retrieve basic information about the hardware components of a system.

+------------------+-----------------------------+-------------------------------------------+-------------------+
| Field            | Description                 | Example                                   | Available         |
+==================+=============================+===========================================+===================+
| **scan_id**      | Scan identifier             | 573872577                                 | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **scan_time**    | Scan date                   | 2018/07/31 15:31:26                       | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **board_serial** | Serial number               | XDR840TUGM65E03171                        | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **cpu_name**     | Cpu name                    | Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **cpu_cores**    | Number of cpu's             | 4                                         | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **cpu_mhz**      | Current proccesor frequency | 900.106                                   | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **ram_total**    | Total RAM Kbytes            | 16374572                                  | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+
| **ram_free**     | Free RAM Kbytes             | 2111928                                   | All               |
+------------------+-----------------------------+-------------------------------------------+-------------------+

 Operating system
 ^^^^^^^^^^^^^^^^

Retrieve basic information about the Operating System.

+------------------+-------------------------+-----------------------------------------------------+-------------------+
| Field            | Description             | Example                                             | Available         |
+==================+=========================+=====================================================+===================+
| **scan_id**      | Scan identifier         | 468455719                                           | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **scan_time**    | Scan date               | 2018/07/31 15:31:26                                 | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **hostname**     | Network hostname        | wazuh-manager                                       | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **architecture** | OS arquitecture         | x86_64                                              | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_name**      | OS name                 | Ubuntu                                              | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_version**   | OS version              | 16.04.5 LTS (Xenial Xerus)                          | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_codename**  | OS version codename     | Xenial Xerus                                        | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_major**     | Major release version   | 16                                                  | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_minor**     | Minor release version   | 04                                                  | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_build**     | Optional build-specific | Revision number                                     | Windows           |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_platform**  | OS platform             | ubuntu                                              | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **sysname**      | System name             | Linux                                               | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **release**      | Release name            | 4.15.0-29-generic                                   | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **version**      | Release version name    | #31~16.04.1-Ubuntu SMP Wed Jul 18 08:54:04 UTC 2018 | All               |
+------------------+-------------------------+-----------------------------------------------------+-------------------+


Network
^^^^^^^

Network scan retrieve information about the existing network interface of a system (up and down interfaces) as well as their routing configuration, it's compose for three tables including
network interfaces and for each of them, associated protocols, network addresses and port information are obtained..

- sys_netiface

+------------------+---------------------------+-----------------------------------------------------+-------------------+
| Field            | Description               | Example                                             | Available         |
+==================+===========================+=====================================================+===================+
| **id**           | Id                        | 1                                                   | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier           | 160615720                                           | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **scan_time**    | Scan date                 | 2018/07/31 16:46:20                                 | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **name**         | Interface name            | eth0                                                | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **adapter**      | Physical adapter name     | Intel(R) PRO/1000 MT Desktop Adapter                | Windows           |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **type**         | Network adapter           | ethernet                                            | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **state**        | State of network          | up                                                  | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **mtu**          | Maximum transmission unit | 1500                                                | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **mac**          | MAC Address               | 08:00:27:C0:14:A5                                   | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_packets**   | Transmitted packets       | 30279                                               | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_packets**   | Received packets          | 12754                                               | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_bytes**     | Transmitted bytes         | 10034626                                            | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_bytes**     | Received bytes            | 1111175                                             | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_errors**    | Transmitted with error    | 0                                                   | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_errors**    | Received with error       | 0                                                   | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_dropped**   | Transmitted and discarded | 0                                                   | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_dropped**   | Received and discarded    | 0                                                   | All               |
+------------------+---------------------------+-----------------------------------------------------+-------------------+

- sys_netproto

+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| Field            | Description                     | Example                                             | Available         |
+==================+=================================+=====================================================+===================+
| **id**           | Referenced id from sys_netiface | 468455719                                           | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier                 | 160615720                                           | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **iface**        | Protocol name                   | ipv4                                                | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **type**         | IP(v4/v6) address               | 192.168.1.87                                        | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **gateway**      | Mask address                    | 255.255.255.0                                       | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **dhcp**         | Broadcast address               | 192.168.1.255                                       | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+

- sys_netaddr

+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| Field            | Description                     | Example                                             | Available         |
+==================+=================================+=====================================================+===================+
| **id**           | Referenced id from sys_netiface | 468455719                                           | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier                 | 160615720                                           | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **proto**        | Protocol name                   | ipv4                                                | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **address**      | IP(v4/v6) address               | 192.168.1.87                                        | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **netmask**      | Mask address                    | 255.255.255.0                                       | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **broadcast**    | Broadcast address               | 192.168.1.255                                       | All               |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+



Packages
^^^^^^^^

The currently packages inventory of each Wazuh agent. On Linux systems, retrieved packages can be `deb` or `rpm` types.

+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field            | Description                            | Example                                           | Available         |
+==================+========================================+===================================================+===================+
| **scan_id**      | Scan identifier                        | 1454946158                                        | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**    | Scan date                              | 2018/07/27 07:27:14                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **format**       | Format of the package                  | deb                                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **name**         | Name of the package                    | linux-headers-generic                             | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **priority**     | Priority of the package                | optional                                          | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **section**      | Section of the package                 | kernel                                            | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **size**         | Size of the installed package in bytes | 14                                                | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **vendor**       | Vendor name                            | Ubuntu Kernel Team <kernel-team@lists.ubuntu.com> | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **install_time** | Time to install the package            |                                                   | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **version**      | Version of the package                 | 4.4.0.130.136                                     | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **architecture** | Architecture of the package            | amd64                                             | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **multiarch**    |                                        |                                                   | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **source**       | Source of the package                  | linux-meta                                        | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **description**  | Description of the package             | Generic Linux kernel headers                      | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **location**     | Location of the package                |                                                   | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **triaged**      |                                        | 0                                                 | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+


Ports
^^^^^

 List of the opened ports of a system.

+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field            | Description                            | Example                                           | Available         |
+==================+========================================+===================================================+===================+
| **scan_id**      | Scan identifier                        | 1618114744                                        | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**    | Scan date                              | 2018/07/27 07:27:15                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **protocol**     | Protocol of the port                   | tcp                                               | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **local_ip**     | Local ip                               | 0.0.0.0                                           | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **local_port**   | Local port                             | 22                                                | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **remote_ip**    | Remote ip                              | 0.0.0.0                                           | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **remote_port**  | Remote port                            | 0                                                 | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tx_queue**     |                                        | 0                                                 | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **rx_queue**     |                                        | 0                                                 | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **inode**        | Inode of the port                      | 16974                                             | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **state**        | State of the port                      | listening                                         | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **PID**          |                                        |                                                   | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **process**      |                                        | linux-meta                                        | All               |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+


Processes
^^^^^^^^^

 List of the current processes running in a system host.

+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field           | Description                            | Example                                           | Available         |
+=================+========================================+===================================================+===================+
| **scan_id**     | Scan identifier                        | 2147483647                                        | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**   | Scan date                              | 2018/07/27 07:27:15                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **pid**         | PID of the process                     | 1238                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **name**        | Name of the process                    | tail                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **state**       | State of the process                   | S                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **ppid**        | PPID of the process                    | 2041                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **utime**       | Time spent executing user code         | 0                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **stime**       | Time spent executing system code       | 13                                                | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **cmd**         | Comand executed                        | tail                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **argvs**       | Arguments of the process               | -Fn1000,/var/ossec/logs/alerts/alerts.log         | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **euser**       | Effective user                         | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **ruser**       | Real user                              | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **suser**       | Saved-set user                         | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **egroup**      | Effective group                        | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **rgroup**      | Real group                             | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **sgroup**      | Saved-set group                        | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **fgroup**      |                                        | root                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **nice**        | Nice value of the process              | 20                                                | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **size**        | Size of the process                    | 0                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **vm_size**     | Total VM size in kB                    | 1510                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **resident**    | Residen size of the process in bytes   | 6040                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **share**       |                                        | 178                                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **start_time**  | Time when the process started          | 161                                               | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **pgrp**        | Process group                          | 120075                                            | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **session**     | Session of the process                 | 2492                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **nlwp**        | Number of light weight processes       | 1925                                              | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tgid**        | Thread Group ID                        | 1                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tty**         | Number of TTY of the process           | 34817                                             | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **processor**   | Number of the processor                | 0                                                 | All               |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+



Compatibility matrix
---------------------

The following table shows the compatibility matrix shows the scans compatibility for the different available operating systems:

+------------------------+----------------------------------------------------------------------+
|                        |                      **Syscollector scan**                           |
+  **Operating System**  +-----------+-----------+-----------+----------+-----------+-----------+
|                        |  Hardware |    OS     |  Packages |  Network |   Ports   | Processes |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    Windows             |     ✓     |     ✓     |     ✓     |     ✓    |     ✓     |     ✓     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    Linux               |     ✓     |     ✓     |     ✓     |     ✓    |     ✓     |     ✓     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    macOS               |     ✓     |     ✓     |     ✓     |     ✓    |     ✗     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    FreeBSD             |     ✓     |     ✓     |     ✓     |     ✓    |     ✗     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    OpenBSD             |     ✓     |     ✓     |     ✗     |     ✓    |     ✗     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+



How it works
-------------



Use case: Visualize system inventory in the Wazuh App
-----------------------------------------------------



.. thumbnail:: ../../images/manual/syscollector-scan.png
    :title: Syscollector scan
    :align: center
    :width: 100%
