.. _wazuh_puppet_reference:

Module reference
==============================

Wazuh manager class
"""""""""""""""""""

class ossec::server
 - ``$mailserver_ip``: SMTP mail server.
 - ``$ossec_emailfrom`` (default: ``ossec@${domain}``: Email "from" address.
 - ``$ossec_emailto``: Email "to" address. ``['user1@mycompany.com','user2@mycompany.com']``
 - ``$ossec_active_response`` (default: ``true``): Enable/disable active response (both on manager and agent).
 - ``$ossec_global_host_information_level`` (default: 8): Alerting level for the events generated by the host change monitor (from 0 to 16).
 - ``$ossec_global_stat_level``: (default: 8): Alerting level for the events generated by the statistical analysis (from 0 to 16).
 - ``$ossec_email_alert_level``: (default: 7): Threshold defining minimum severity for a rule to fire an email alert. Some rules circumvent this threshold (``alert_email`` option).
 - ``$ossec_emailnotification``: (default: yes): Whether or not to send email notifications.
 - ``$ossec_prefilter`` : (default: ``false``) Command to run to prevent prelinking from creating false positives. ``This option can potentially impact performance negatively. The configured command will be run for each and every file checked.``
 - ``$local_decoder_template``:  (default: ``ossec/local_decoder.xml.erb``)
 - ``$local_rules_template``:   (default: ``ossec/local_rules.xml.erb``)
 - ``$manage_repo`` (default: ``true``): Install Wazuh through Wazuh repositories.
 - ``$manage_epel_repo`` (default: ``true``): Install epel repo and inotify-tools
 - ``$manage_paths`` (default: ``[ {'path' => '/etc,/usr/bin,/usr/sbin', 'report_changes' => 'no', 'realtime' => 'no'}, {'path' => '/bin,/sbin', 'report_changes' => 'yes', 'realtime' => 'yes'} ]``): Follow the instructions below.
 - ``$ossec_white_list``: Allow white listing of IP addresses.
 - ``$manage_client_keys``: (default: ``true``): Manage client keys option.
 - ``$ossec_auto_ignore``: (default: ``yes``): Specifies if syscheck will ignore files that change too often (after the third change)
 - ``$use_mysql``: (default: ``false``). Set to ``true`` to enable database integration for alerts and other outputs.
 - ``$mariadb``: (default: ``false``). Set to ``true`` to enable the use of mariadb instead of mysql.
 - ``$mysql_hostname``: MySQL hostname.
 - ``$mysql_name``: MySQL Database name.
 - ``$mysql_password``: MySQL password.
 - ``$mysql_username``: MySQL username.
 - ``$ossec_extra_rules_config``: To use it, after enabling the Wazuh ruleset (either manually or via the automated script), take a look at the changes made to the ossec.conf file. You will need to put these same changes into the "$ossec_extra_rules_config" array parameter when calling the ossec::server class.
 - ``$ossec_email_maxperhour``: (default: ``12``): Global Configuration with maximum number of emails per hour
 - ``$ossec_email_idsname``: (default: ``undef``)



Consequently, if you add or remove any of the Wazuh rules later on, you'll need to ensure you add/remove the appropriate bits in the "$ossec_extra_rules_config" array parameter as well.

function ossec::email_alert
 - ``$alert_email``: Email to send to.
 - ``$alert_group``: (default: ``false``): Array of rule group names.

.. note:: No email will be sent for alerts with a severity below the global ``$ossec_email_alert_level``, unless the rule has alert_email set.

function ossec::command
 - ``$command_name``: Human readable name for ``ossec::activeresponse`` usage.
 - ``$command_executable``: Name of the executable. OSSEC comes preloaded with ``disable-account.sh``, ``host-deny.sh``, ``ipfw.sh``, ``pf.sh``, ``route-null.sh``, ``firewall-drop.sh``, ``ipfw_mac.sh``, ``ossec-tweeter.sh``, ``restart-ossec.sh``.
 - ``$command_expect`` (default: ``srcip``).
 - ``$timeout_allowed`` (default: ``true``).

function ossec::activeresponse
 - ``$command_name``.
 - ``$ar_location`` (default: ``local``): It can be set to ``local``,``server``,``defined-agent``,``all``.
 - ``$ar_level`` (default: 7): Can take values between 0 and 16.
 - ``$ar_rules_id`` (default: ``[]``): List of rule IDs.
 - ``$ar_timeout`` (default: 300): Usually active response blocks for a certain amount of time.
 - ``$ar_repeated_offenders`` (default: empty): A comma separated list of increasing timeouts in minutes for repeat offenders. There can be a maximum of 5 entries.

function ossec::addlog
 - ``$log_name``.
 - ``$agent_log``: (default: ``false``)
 - ``$logfile`` /path/to/log/file.
 - ``$logtype`` (default: syslog): The OSSEC ``log_format`` of the file.

Wazuh agent class
"""""""""""""""""

 - ``$ossec_server_ip``: IP of the server.
 - ``$ossec_server_hostname``: Hostname of the server.
 - ``$ossec_active_response`` (default: ``true``): Allows active response on this host.
 - ``$ossec_emailnotification`` (default: ``yes``): Whether to send email notifications or not.
 - ``$ossec_prefilter`` : (default: ``false``) Command to run to prevent prelinking from creating false positives. ``This option can potentially impact performance negatively. The configured command will be run for each and every file checked.``
 - ``$selinux`` (default: ``false``): Whether to install a SELinux policy to allow rotation of OSSEC logs.
 - ``agent_name`` (default: ``$::hostname``)
 - ``agent_ip_address`` (default: ``$::ipaddress``)
 - ``$manage_repo`` (default: ``true``): Install Wazuh through Wazuh repositories.
 - ``$manage_epel_repo`` (default: ``true``): Install epel repo and inotify-tools
 - ``$ossec_scanpaths`` (default: ``[]``): Agents can be Linux or Windows.  For this reason don't have ``ossec_scanpaths`` by default.
 - ``$manage_client_keys``: (default: ``true``): Manage client keys option.
 - ``$ar_repeated_offenders``: (default: empty) A comma separated list of increasing timeouts in minutes for repeat offenders. There can be a maximum of 5 entries.

function ossec::addlog
 - ``$log_name``.
 - ``$agent_log`` (default: ``false``)
 - ``$logfile`` /path/to/log/file.
 - ``$logtype`` (default: syslog): The OSSEC ``log_format`` of the file.

ossec_scanpaths configuration
"""""""""""""""""""""""""""""

Leaving this unconfigured will result in Wazuh using the module defaults. By default, it will monitor /etc, /usr/bin, /usr/sbin, /bin and /sbin on the Wazuh Server, with real time monitoring disabled and report_changes enabled.

To overwrite the defaults or add in new paths to scan, you can use hiera to overwrite the defaults.

To tell Wazuh to enable real time monitoring of the default paths:

ossec::server::ossec_scanpaths:
  - path: /etc
    report_changes: 'no'
    realtime: 'no'
  - path: /usr/bin
    report_changes: 'no'
    realtime: 'no'
  - path: /usr/sbin
    report_changes: 'no'
    realtime: 'no'
  - path: /bin
    report_changes: 'yes'
    realtime: 'yes'
  - path: /sbin
    report_changes: 'yes'
    realtime: 'yes'

**Note: Configuring the ossec_scanpaths variable will overwrite the default paths. If you want to add a new directory to monitor, you must also add the above default paths to be monitored as well.**
