.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Cisco Umbrella is a cloud-based Secure Internet Gateway (SIG) platform that provides you with multiple levels of defense against internet-based threats. Learn how to configure and monitor it with Wazuh.

Cisco Umbrella
==============

`Cisco Umbrella <https://umbrella.cisco.com/>`__ is a cloud-based Secure Internet Gateway (SIG) platform that provides you with multiple levels of defense against internet-based threats.

Cisco Umbrella configuration
----------------------------

You can find how to configure this service by following the `official documentation <https://docs.umbrella.com/deployment-umbrella/docs/welcome-to-cisco-umbrella>`__ on its official website. Furthermore, it is mandatory to configure that the logs generated by this service would be exported to an S3 bucket. You can find how to do that in the `log management section <https://docs.umbrella.com/deployment-umbrella/docs/log-management>`__ of the official documentation.

.. _umbrella_policy_configuration:

Policy configuration
--------------------

.. include:: /_templates/cloud/amazon/create_policy.rst
.. include:: /_templates/cloud/amazon/bucket_policies.rst
.. include:: /_templates/cloud/amazon/attach_policy.rst

Configure Wazuh to process Cisco Umbrella logs
----------------------------------------------

#. Access the Wazuh configuration in **Server management** > **Settings** using the Wazuh dashboard or by manually editing the ``/var/ossec/etc/ossec.conf`` file in the Wazuh server or agent.

   .. thumbnail:: /images/cloud-security/aws/cisco-umbrella/01-wazuh-configuration.png
      :align: center
      :width: 80%

   .. thumbnail:: /images/cloud-security/aws/cisco-umbrella/02-wazuh-configuration.png
      :align: center
      :width: 80%

#. Add the following :doc:`Wazuh module for AWS </user-manual/reference/ossec-conf/wodle-s3>` configuration to the file, replacing ``<WAZUH_AWS_BUCKET>`` with the name of the S3 bucket:

   .. code-block:: xml

      <wodle name="aws-s3">

        <disabled>no</disabled>
        <interval>10m</interval>
        <run_on_start>yes</run_on_start>
        <skip_on_error>yes</skip_on_error>

        <bucket type="cisco_umbrella">
          <name><WAZUH_AWS_BUCKET></name>
          <path>dnslogs</path>
          <aws_profile>default</aws_profile>
        </bucket>

        <bucket type="cisco_umbrella">
          <name><WAZUH_AWS_BUCKET></name>
          <path>proxylogs</path>
          <aws_profile>default</aws_profile>
        </bucket>

      </wodle>

#. Save the changes and restart Wazuh to apply the changes. The service can be manually restarted using the following command outside the Wazuh dashboard:

   -  Wazuh manager:

      .. code-block:: console

         # systemctl restart wazuh-manager

   -  Wazuh agent:

      .. code-block:: console

         # systemctl restart wazuh-agent
