.. Copyright (C) 2020 Wazuh, Inc.

.. _cisco_umbrella:

Cisco Umbrella
==============

`Cisco Umbrella <https://umbrella.cisco.com/>`_ uses the internet infrastructure to block malicious destinations before a connection is ever established.

Cisco Umbrella configuration
----------------------------

You can find how to configure this service by following the official documentation on `its official website <https://docs.umbrella.com/deployment-umbrella/docs/welcome-to-cisco-umbrella>`_. Furthermore, it is mandatory to configure that the logs generated by this service would be exported to an S3 bucket. You can find how to do that in the `log management section <https://docs.umbrella.com/deployment-umbrella/docs/log-management>`_ of the official documentation.

Wazuh configuration
-------------------

.. note::
  It is required to append the type of logs inside ``path`` tag as in the next example. `dnslogs`, `proxylogs`, and `iplogs` are currently supported. Each one require to be defined in an independent ``bucket`` tag.

1. Open the Wazuh configuration file (``/var/ossec/etc/ossec.conf``) and add the following block (this example is for `dnslogs` and `proxylogs`, it is not required to add both):

    .. code-block:: xml

      <wodle name="aws-s3">

        <disabled>no</disabled>
        <interval>10m</interval>
        <run_on_start>yes</run_on_start>
        <skip_on_error>yes</skip_on_error>

        <bucket type="cisco_umbrella">
          <name>cisco-managed-us-east-1</name>
          <path>123456_abcdef0123456789/dnslogs</path>
          <aws_profile>default</aws_profile>
        </bucket>

        <bucket type="cisco_umbrella">
          <name>cisco-managed-us-east-1</name>
          <path>123456_abcdef0123456789/proxylogs</path>
          <aws_profile>default</aws_profile>
        </bucket>

      </wodle>

    .. note::
      Check the :ref:`AWS S3 module <wodle_s3>` reference manual to learn more about each setting.

2. Restart Wazuh in order to apply the changes:

    * If you're configuring a Wazuh manager:

      a. For Systemd:

      .. code-block:: console

        # systemctl restart wazuh-manager

      b. For SysV Init:

      .. code-block:: console

        # service wazuh-manager restart

    * If you're configuring a Wazuh agent:

      a. For Systemd:

      .. code-block:: console

        # systemctl restart wazuh-agent

      b. For SysV Init:

      .. code-block:: console

        # service wazuh-agent restart
